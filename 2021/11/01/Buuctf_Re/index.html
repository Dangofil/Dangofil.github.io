<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Buuctf_Re page1 | Dangofilの博客</title><meta name="author" content="Dangofil"><meta name="copyright" content="Dangofil"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Re  easyre查壳  无壳，拖入ida64 小tips：因为整理桌面，将ida的路径放到了中文文件夹里，报错了，下次注意    直接看到flag：flag{this_Is_a_EaSyRe}  reverse1查壳  无壳，拖入ida64，无明显线索，通过“shift+f12”查找可疑字符串"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="http://example.com/2021/11/01/Buuctf_Re/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Buuctf_Re page1',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-23 17:50:50'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="../images/loading.png" data-original="/img/favicon.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">61</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://eternitywith.gitee.io/image/19.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Dangofilの博客"><span class="site-name">Dangofilの博客</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Buuctf_Re page1</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-11-01T04:33:20.000Z" title="发表于 2021-11-01 12:33:20">2021-11-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-23T09:50:50.512Z" title="更新于 2022-11-23 17:50:50">2022-11-23</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Buuctf_Re page1"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h1><span id="more"></span>

<h2 id="easyre"><a href="#easyre" class="headerlink" title="easyre"></a>easyre</h2><p>查壳</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211101153849025.png" alt="image-20211101153849025"></p>
<p>无壳，拖入ida64</p>
<p>小tips：因为整理桌面，将ida的路径放到了中文文件夹里，报错了，下次注意</p>
<p>  <img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/1827556-20191017172917220-39061608-16357529007402.png" alt="1827556-20191017172917220-39061608-16357529007402"></p>
<p>直接看到flag：flag{this_Is_a_EaSyRe}</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211101154617637.png" alt="image-20211101154617637"></p>
<h2 id="reverse1"><a href="#reverse1" class="headerlink" title="reverse1"></a>reverse1</h2><p>查壳</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211101162710144.png" alt="image-20211101162710144"></p>
<p>无壳，拖入ida64，无明显线索，通过“shift+f12”查找可疑字符串</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211101163108744.png" alt="image-20211101163108744"></p>
<p>双击字符串，x键交叉引用，定位到关键程序</p>
<p>f5反编译</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">__int64 <span class="hljs-title">sub_1400118C0</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">char</span> *v0; <span class="hljs-comment">// rdi</span><br>  __int64 i; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">size_t</span> v2; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">size_t</span> v3; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">char</span> v5[<span class="hljs-number">36</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-20h] BYREF</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+24h] [rbp+4h]</span><br>  <span class="hljs-type">char</span> Str1[<span class="hljs-number">224</span>]; <span class="hljs-comment">// [rsp+48h] [rbp+28h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 v8; <span class="hljs-comment">// [rsp+128h] [rbp+108h]</span><br><br>  v0 = v5;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">82</span>i64; i; --i )<br>  &#123;<br>    *(_DWORD *)v0 = <span class="hljs-number">-858993460</span>;<br>    v0 += <span class="hljs-number">4</span>;<br>  &#125;<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; ; ++j )<br>  &#123;<br>    v8 = j;<br>    v2 = <span class="hljs-built_in">j_strlen</span>(Str2);<br>    <span class="hljs-keyword">if</span> ( v8 &gt; v2 )<br>      <span class="hljs-keyword">break</span>;               <span class="hljs-comment">//下标超过str2[]时退出</span><br>    <span class="hljs-keyword">if</span> ( Str2[j] == <span class="hljs-number">111</span> )  <br>      Str2[j] = <span class="hljs-number">48</span>;        <span class="hljs-comment">//将str2中的&#x27;O&#x27;换成&#x27;0&#x27;   </span><br>  &#125;<br>  <span class="hljs-built_in">sub_1400111D1</span>(<span class="hljs-string">&quot;input the flag:&quot;</span>);      <br>  <span class="hljs-built_in">sub_14001128F</span>(<span class="hljs-string">&quot;%20s&quot;</span>, Str1);  <span class="hljs-comment">//str1为输入</span><br>  v3 = <span class="hljs-built_in">j_strlen</span>(Str2);<br>  <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">strncmp</span>(Str1, Str2, v3) )   <span class="hljs-comment">//将str1和str2作比较</span><br>    <span class="hljs-built_in">sub_1400111D1</span>(<span class="hljs-string">&quot;this is the right flag!\n&quot;</span>);<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">sub_1400111D1</span>(<span class="hljs-string">&quot;wrong flag\n&quot;</span>);<br>  <span class="hljs-built_in">sub_14001113B</span>(v5, &amp;unk_140019D00);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>i64;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>逻辑很简单，将str2中的’o’替换成’0’，与我们输入的str1比较，相同时，输入即为flag</p>
<p>双击str2，查看data段数据</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211101164221605.png" alt="image-20211101164221605"></p>
<p>答案显而易见了，flag：flag{hell0_w0rld}</p>
<h2 id="reverse2"><a href="#reverse2" class="headerlink" title="reverse2"></a>reverse2</h2><p>查壳</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211101164704464.png" alt="image-20211101164704464"></p>
<p>无壳，且为elf文件，请出我们的ida64</p>
<p>打开即为关键代码，直接F5反编译</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"> </span>&#123;<br>   <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>   <span class="hljs-type">int</span> stat_loc; <span class="hljs-comment">// [rsp+4h] [rbp-3Ch] BYREF</span><br>   <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+8h] [rbp-38h]</span><br>   <span class="hljs-type">__pid_t</span> pid; <span class="hljs-comment">// [rsp+Ch] [rbp-34h]</span><br>   <span class="hljs-type">char</span> s2[<span class="hljs-number">24</span>]; <span class="hljs-comment">// [rsp+10h] [rbp-30h] BYREF</span><br>   <span class="hljs-type">unsigned</span> __int64 v8; <span class="hljs-comment">// [rsp+28h] [rbp-18h]</span><br> <br>   v8 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>   pid = fork();<br>   <span class="hljs-keyword">if</span> ( pid )<br>   &#123;<br>     <span class="hljs-built_in">waitpid</span>(pid, &amp;stat_loc, <span class="hljs-number">0</span>);<br>   &#125;<br>   <span class="hljs-keyword">else</span><br>   &#123;<br>     <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-built_in">strlen</span>(&amp;flag); ++i )<br>     &#123;<br>       <span class="hljs-keyword">if</span> ( *(&amp;flag + i) == <span class="hljs-number">105</span> || *(&amp;flag + i) == <span class="hljs-number">114</span> )  <br>         *(&amp;flag + i) = <span class="hljs-number">49</span>;<br>     &#125;                       <span class="hljs-comment">//遍历flag数组，如果flag[i] = &#x27;i&#x27;或&#x27;r&#x27;，则替换成&#x27;1&#x27;</span><br>   &#125;<br>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;input the flag:&quot;</span>);<br>   __isoc99_scanf(<span class="hljs-string">&quot;%20s&quot;</span>, s2); <span class="hljs-comment">//s2为输入</span><br>   <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">strcmp</span>(&amp;flag, s2) )   <span class="hljs-comment">//将s2和flag做比较</span><br>     result = <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;this is the right flag!&quot;</span>);<br>   <span class="hljs-keyword">else</span><br>     result = <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;wrong flag!&quot;</span>);<br>   <span class="hljs-keyword">return</span> result;<br> &#125;<br></code></pre></td></tr></table></figure>

<p>和上一题大同小异，遍历flag数组，如果flag[i] = ‘i’或’r’，则替换成’1’，然后与我们输入的s2作比较，如果相同，则输入为flag</p>
<p>双击flag查看数据</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211101165741260.png" alt="image-20211101165741260"></p>
<p>答案显而易见，flag：flag{hack1ng_fo1_fun}</p>
<h2 id="内涵的软件"><a href="#内涵的软件" class="headerlink" title="内涵的软件"></a>内涵的软件</h2><p>尝试运行程序</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211101202719085.png" alt="image-20211101202719085"></p>
<p>查壳</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211101202819273.png" alt="image-20211101202819273"></p>
<p>无壳，拖入ida，反编译</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> __cdecl <span class="hljs-title">main_0</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> v4[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [esp+4Ch] [ebp-Ch] BYREF</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v5; <span class="hljs-comment">// [esp+50h] [ebp-8h]</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// [esp+54h] [ebp-4h]</span><br><br>  v6 = <span class="hljs-number">5</span>;<br>  v5 = <span class="hljs-string">&quot;DBAPP&#123;49d3c93df25caad81232130f3d2ebfad&#125;&quot;</span>;<br>  <span class="hljs-keyword">while</span> ( v6 &gt;= <span class="hljs-number">0</span> )<br>  &#123;<br>    <span class="hljs-built_in">printf</span>(aD, v6);<br>    <span class="hljs-built_in">sub_40100A</span>();<br>    --v6;<br>  &#125;<br>  <span class="hljs-built_in">printf</span>(<br>    <span class="hljs-string">&quot;\n&quot;</span><br>    <span class="hljs-string">&quot;\n&quot;</span><br>    <span class="hljs-string">&quot;\n&quot;</span><br>    <span class="hljs-string">&quot;这里本来应该是答案的,但是粗心的程序员忘记把变量写进来了,你要不逆向试试看:(Y/N)\n&quot;</span>);<br>  v4[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%c&quot;</span>, v4);   <span class="hljs-comment">//输入为v4</span><br>  <span class="hljs-keyword">if</span> ( v4[<span class="hljs-number">0</span>] == <span class="hljs-number">89</span> )<br>  &#123;<br>    <span class="hljs-built_in">printf</span>(aOdIda);<br>    result = <span class="hljs-built_in">sub_40100A</span>();<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-keyword">if</span> ( v4[<span class="hljs-number">0</span>] == <span class="hljs-number">78</span> )<br>      <span class="hljs-built_in">printf</span>(asc_425034);<br>    <span class="hljs-keyword">else</span><br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;输入错误,没有提示.&quot;</span>);<br>    result = <span class="hljs-built_in">sub_40100A</span>();<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>笑死，我居然在一本正经的分析逻辑</p>
<p>flag：flag{49d3c93df25caad81232130f3d2ebfad}（好一个“内涵”）</p>
<p>小彩蛋（虽然没什么软用）</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211101203709864.png" alt="image-20211101203709864"></p>
<h2 id="新年快乐"><a href="#新年快乐" class="headerlink" title="新年快乐"></a>新年快乐</h2><p>尝试运行</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211101203921845.png" alt="image-20211101203921845"></p>
<p>可知正确输入即为flag</p>
<p>查壳</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211101204008140.png" alt="image-20211101204008140"></p>
<p>可以看到，该程序由upx壳加密，使用官方upx脱壳</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211101204221435.png" alt="image-20211101204221435"></p>
<p>再次使用Exeinfo pe查看</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211101204329565.png" alt="image-20211101204329565"></p>
<p>可以看到，脱壳成功</p>
<p>使用ida分析，反编译</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> Str2[<span class="hljs-number">14</span>]; <span class="hljs-comment">// [esp+12h] [ebp-3Ah] BYREF</span><br>  __int16 Str1; <span class="hljs-comment">// [esp+20h] [ebp-2Ch] BYREF</span><br>  _BYTE v6[<span class="hljs-number">30</span>]; <span class="hljs-comment">// [esp+22h] [ebp-2Ah] BYREF</span><br><br>  __main();<br>  <span class="hljs-built_in">strcpy</span>(Str2, <span class="hljs-string">&quot;HappyNewYear!&quot;</span>);<br>  Str1 = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">memset</span>(v6, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(v6));<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;please input the true flag:&quot;</span>);<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, &amp;Str1);    <span class="hljs-comment">//输入为str1</span><br>  <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">strncmp</span>((<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)&amp;Str1, Str2, <span class="hljs-built_in">strlen</span>(Str2)) )  <span class="hljs-comment">//判断str1与str2是否相等</span><br>    result = <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;this is true flag!&quot;</span>);<br>  <span class="hljs-keyword">else</span><br>    result = <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;wrong!&quot;</span>);<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>可以看出，这仅仅是一道脱壳题，脱壳后将输入的str与str2比较，相等则为flag</p>
<p>flag：flag{HappyNewYear!}</p>
<h2 id="xor"><a href="#xor" class="headerlink" title="xor"></a>xor</h2><p>查壳</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211101214026995.png" alt="image-20211101214026995"></p>
<p>看不大懂，但可以知道是在macos下编译的程序，我选择相信我们的ida（64）</p>
<p>好的ida牛逼</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+2Ch] [rbp-124h]</span><br>  <span class="hljs-type">char</span> __b[<span class="hljs-number">264</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-110h] BYREF</span><br><br>  <span class="hljs-built_in">memset</span>(__b, <span class="hljs-number">0</span>, <span class="hljs-number">0x100</span>uLL);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Input your flag:\n&quot;</span>);<br>  <span class="hljs-built_in">get_line</span>(__b, <span class="hljs-number">256LL</span>);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(__b) != <span class="hljs-number">33</span> )    <span class="hljs-comment">//__b的长度为33</span><br>    <span class="hljs-keyword">goto</span> LABEL_7;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">33</span>; ++i )<br>    __b[i] ^= __b[i - <span class="hljs-number">1</span>];     <span class="hljs-comment">//从下标为一开始，与前一位进行异或</span><br>  <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">strncmp</span>(__b, global, <span class="hljs-number">0x21</span>uLL) )<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Success&quot;</span>);         <span class="hljs-comment">//与global字符串进行比较</span><br>  <span class="hljs-keyword">else</span><br>LABEL_7:<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Failed&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>这里查阅资料，了解了一下get_line()函数，此函数可读取整行，包括前导和嵌入的空格，并将其存储在字符串对象中</p>
<p>简单来说，就是解决了cin()的，无法输入’ ‘的问题</p>
<p>分析逻辑，程序将我们输入的字符串，从下标为1开始，与前一位进行异或，最后与global字符串进行比较</p>
<p>global的值</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211101215422611.png" alt="image-20211101215422611"></p>
<p>由于两次异或就是原来的值，那么我们编写exp进行解密</p>
<p>exp如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">str1 = [ <span class="hljs-number">0x66</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x11</span>, <br>  <span class="hljs-number">0x78</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x3B</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x1F</span>, <br>  <span class="hljs-number">0x76</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x0F</span>, <br>  <span class="hljs-number">0x47</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x4F</span>]<br>x = <span class="hljs-string">&#x27;f&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(str1)):<br>    x += <span class="hljs-built_in">chr</span>(str1[i] ^ str1[i - <span class="hljs-number">1</span>])<br><span class="hljs-built_in">print</span>(x)<br></code></pre></td></tr></table></figure>

<h2 id="helloworld"><a href="#helloworld" class="headerlink" title="helloworld"></a>helloworld</h2><p>apk文件，使用jadx进行分析</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211102173354215.png" alt="image-20211102173354215"></p>
<p>就…找到了</p>
<p>flag：flag{7631a988259a00816deda84afb29430a}</p>
<h2 id="reverse3"><a href="#reverse3" class="headerlink" title="reverse3"></a>reverse3</h2><p>rar文件，使用7-zip解压</p>
<p>查壳</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211102173703469.png" alt="image-20211102173703469"></p>
<p>无壳，拖入ida，定位到主函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> __cdecl <span class="hljs-title">main_0</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">size_t</span> v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v4; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">size_t</span> v5; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> v7; <span class="hljs-comment">// [esp+0h] [ebp-188h]</span><br>  <span class="hljs-type">char</span> v8; <span class="hljs-comment">// [esp+0h] [ebp-188h]</span><br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> j; <span class="hljs-comment">// [esp+DCh] [ebp-ACh]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+E8h] [ebp-A0h]</span><br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> v11; <span class="hljs-comment">// [esp+E8h] [ebp-A0h]</span><br>  <span class="hljs-type">char</span> Destination[<span class="hljs-number">108</span>]; <span class="hljs-comment">// [esp+F4h] [ebp-94h] BYREF</span><br>  <span class="hljs-type">char</span> Str[<span class="hljs-number">28</span>]; <span class="hljs-comment">// [esp+160h] [ebp-28h] BYREF</span><br>  <span class="hljs-type">char</span> v14[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [esp+17Ch] [ebp-Ch] BYREF</span><br><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; ++i )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)i &gt;= <span class="hljs-number">0x64</span> )<br>      <span class="hljs-built_in">j____report_rangecheckfailure</span>();<br>    Destination[i] = <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-built_in">sub_41132F</span>(<span class="hljs-string">&quot;please enter the flag:&quot;</span>, v7);<br>  <span class="hljs-built_in">sub_411375</span>(<span class="hljs-string">&quot;%20s&quot;</span>, (<span class="hljs-type">char</span>)Str);<br>  v3 = <span class="hljs-built_in">j_strlen</span>(Str);<br>  v4 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)<span class="hljs-built_in">sub_4110BE</span>(Str, v3, v14);   <span class="hljs-comment">//将我们输入的str经sub_4110BE加密后，返回给v4</span><br>  <span class="hljs-built_in">strncpy</span>(Destination, v4, <span class="hljs-number">0x28</span>u);         <span class="hljs-comment">//将v4连接到Destination后</span><br>  v11 = <span class="hljs-built_in">j_strlen</span>(Destination);<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt; v11; ++j )              <span class="hljs-comment">//循环修改Destination值</span><br>    Destination[j] += j;<br>  v5 = <span class="hljs-built_in">j_strlen</span>(Destination);<br>  <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">strncmp</span>(Destination, Str2, v5) )   <span class="hljs-comment">//将Destination与Str2作比较</span><br>    <span class="hljs-built_in">sub_41132F</span>(<span class="hljs-string">&quot;rigth flag!\n&quot;</span>, v8);<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">sub_41132F</span>(<span class="hljs-string">&quot;wrong flag!\n&quot;</span>, v8);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>sub_4110BE（）函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> *__cdecl <span class="hljs-title">sub_411AB0</span><span class="hljs-params">(<span class="hljs-type">char</span> *a1, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> a2, <span class="hljs-type">int</span> *a3)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// [esp+D4h] [ebp-38h]</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// [esp+D4h] [ebp-38h]</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// [esp+D4h] [ebp-38h]</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// [esp+D4h] [ebp-38h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+E0h] [ebp-2Ch]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [esp+ECh] [ebp-20h]</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [esp+ECh] [ebp-20h]</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// [esp+ECh] [ebp-20h]</span><br>  <span class="hljs-type">void</span> *v12; <span class="hljs-comment">// [esp+F8h] [ebp-14h]</span><br>  <span class="hljs-type">char</span> *v13; <span class="hljs-comment">// [esp+104h] [ebp-8h]</span><br><br>  <span class="hljs-keyword">if</span> ( !a1 || !a2 )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  v9 = a2 / <span class="hljs-number">3</span>;<br>  <span class="hljs-keyword">if</span> ( (<span class="hljs-type">int</span>)(a2 / <span class="hljs-number">3</span>) % <span class="hljs-number">3</span> )<br>    ++v9;<br>  v10 = <span class="hljs-number">4</span> * v9;<br>  *a3 = v10;<br>  v12 = <span class="hljs-built_in">malloc</span>(v10 + <span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">if</span> ( !v12 )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">j_memset</span>(v12, <span class="hljs-number">0</span>, v10 + <span class="hljs-number">1</span>);<br>  v13 = a1;<br>  v11 = a2;<br>  v4 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">while</span> ( v11 &gt; <span class="hljs-number">0</span> )<br>  &#123;<br>    byte_41A144[<span class="hljs-number">2</span>] = <span class="hljs-number">0</span>;<br>    byte_41A144[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;<br>    byte_41A144[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span> &amp;&amp; v11 &gt;= <span class="hljs-number">1</span>; ++i )<br>    &#123;<br>      byte_41A144[i] = *v13;<br>      --v11;<br>      ++v13;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( !i )<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">switch</span> ( i )<br>    &#123;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>        *((_BYTE *)v12 + v4) = aAbcdefghijklmn[(<span class="hljs-type">int</span>)(<span class="hljs-type">unsigned</span> __int8)byte_41A144[<span class="hljs-number">0</span>] &gt;&gt; <span class="hljs-number">2</span>];<br>        v5 = v4 + <span class="hljs-number">1</span>;<br>        *((_BYTE *)v12 + v5) = aAbcdefghijklmn[((byte_41A144[<span class="hljs-number">1</span>] &amp; <span class="hljs-number">0xF0</span>) &gt;&gt; <span class="hljs-number">4</span>) | (<span class="hljs-number">16</span> * (byte_41A144[<span class="hljs-number">0</span>] &amp; <span class="hljs-number">3</span>))];<br>        *((_BYTE *)v12 + ++v5) = aAbcdefghijklmn[<span class="hljs-number">64</span>];<br>        *((_BYTE *)v12 + ++v5) = aAbcdefghijklmn[<span class="hljs-number">64</span>];<br>        v4 = v5 + <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>        *((_BYTE *)v12 + v4) = aAbcdefghijklmn[(<span class="hljs-type">int</span>)(<span class="hljs-type">unsigned</span> __int8)byte_41A144[<span class="hljs-number">0</span>] &gt;&gt; <span class="hljs-number">2</span>];<br>        v6 = v4 + <span class="hljs-number">1</span>;<br>        *((_BYTE *)v12 + v6) = aAbcdefghijklmn[((byte_41A144[<span class="hljs-number">1</span>] &amp; <span class="hljs-number">0xF0</span>) &gt;&gt; <span class="hljs-number">4</span>) | (<span class="hljs-number">16</span> * (byte_41A144[<span class="hljs-number">0</span>] &amp; <span class="hljs-number">3</span>))];<br>        *((_BYTE *)v12 + ++v6) = aAbcdefghijklmn[((byte_41A144[<span class="hljs-number">2</span>] &amp; <span class="hljs-number">0xC0</span>) &gt;&gt; <span class="hljs-number">6</span>) | (<span class="hljs-number">4</span> * (byte_41A144[<span class="hljs-number">1</span>] &amp; <span class="hljs-number">0xF</span>))];<br>        *((_BYTE *)v12 + ++v6) = aAbcdefghijklmn[<span class="hljs-number">64</span>];<br>        v4 = v6 + <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>        *((_BYTE *)v12 + v4) = aAbcdefghijklmn[(<span class="hljs-type">int</span>)(<span class="hljs-type">unsigned</span> __int8)byte_41A144[<span class="hljs-number">0</span>] &gt;&gt; <span class="hljs-number">2</span>];<br>        v7 = v4 + <span class="hljs-number">1</span>;<br>        *((_BYTE *)v12 + v7) = aAbcdefghijklmn[((byte_41A144[<span class="hljs-number">1</span>] &amp; <span class="hljs-number">0xF0</span>) &gt;&gt; <span class="hljs-number">4</span>) | (<span class="hljs-number">16</span> * (byte_41A144[<span class="hljs-number">0</span>] &amp; <span class="hljs-number">3</span>))];<br>        *((_BYTE *)v12 + ++v7) = aAbcdefghijklmn[((byte_41A144[<span class="hljs-number">2</span>] &amp; <span class="hljs-number">0xC0</span>) &gt;&gt; <span class="hljs-number">6</span>) | (<span class="hljs-number">4</span> * (byte_41A144[<span class="hljs-number">1</span>] &amp; <span class="hljs-number">0xF</span>))];<br>        *((_BYTE *)v12 + ++v7) = aAbcdefghijklmn[byte_41A144[<span class="hljs-number">2</span>] &amp; <span class="hljs-number">0x3F</span>];<br>        v4 = v7 + <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>  &#125;<br>  *((_BYTE *)v12 + v4) = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">return</span> v12;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>不难看出，是base64加密</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211102174854568.png" alt="image-20211102174854568"></p>
<p>既然如此，那逻辑就很简单了，先将我们输入的str进行base64加密，然后进行循环 Destination[j] += j 操作，最后与str2比较，str2的值如下图</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211102175313680.png" alt="image-20211102175313680"></p>
<p>那么解密逻辑即是，将str2循环作 str2[j] -= j 操作，然后进行base64解密，即可得到flag</p>
<p>编写exp解密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-keyword">import</span> base64<br>s = <span class="hljs-string">&quot;e3nifIH9b_C@n@dH&quot;</span><br>x = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(s)):<br>    x +=<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(s[i]) - i)<br><br><span class="hljs-built_in">print</span>(base64.b64decode(x))<br></code></pre></td></tr></table></figure>

<p>运行后得到flag</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211102180430755.png" alt="image-20211102180430755"></p>
<p>flag：flag{i_l0ve_you}</p>
<h2 id="不一样的flag"><a href="#不一样的flag" class="headerlink" title="不一样的flag"></a>不一样的flag</h2><p>查壳</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211102180925285.png" alt="image-20211102180925285"></p>
<p>无壳，拖入ida，查看伪代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> __cdecl __noreturn <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">char</span> v3[<span class="hljs-number">29</span>]; <span class="hljs-comment">// [esp+17h] [ebp-35h] BYREF</span><br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// [esp+34h] [ebp-18h]</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// [esp+38h] [ebp-14h] BYREF</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+3Ch] [ebp-10h]</span><br>  _BYTE v7[<span class="hljs-number">12</span>]; <span class="hljs-comment">// [esp+40h] [ebp-Ch] BYREF</span><br><br>  __main();<br>  v4 = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">strcpy</span>(v3, <span class="hljs-string">&quot;*11110100001010000101111#&quot;</span>);<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;you can choose one action to execute&quot;</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;1 up&quot;</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;2 down&quot;</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;3 left&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;4 right\n:&quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;v5);<br>    <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">2</span> )<br>    &#123;<br>      ++*(_DWORD *)&amp;v3[<span class="hljs-number">25</span>];<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( v5 &gt; <span class="hljs-number">2</span> )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-number">3</span> )<br>      &#123;<br>        --v4;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        <span class="hljs-keyword">if</span> ( v5 != <span class="hljs-number">4</span> )<br>LABEL_13:<br>          <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>        ++v4;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-keyword">if</span> ( v5 != <span class="hljs-number">1</span> )<br>        <span class="hljs-keyword">goto</span> LABEL_13;<br>      --*(_DWORD *)&amp;v3[<span class="hljs-number">25</span>];<br>    &#125;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">1</span>; ++i )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( *(<span class="hljs-type">int</span> *)&amp;v3[<span class="hljs-number">4</span> * i + <span class="hljs-number">25</span>] &lt; <span class="hljs-number">0</span> || *(<span class="hljs-type">int</span> *)&amp;v3[<span class="hljs-number">4</span> * i + <span class="hljs-number">25</span>] &gt; <span class="hljs-number">4</span> )<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v7[<span class="hljs-number">5</span> * *(_DWORD *)&amp;v3[<span class="hljs-number">25</span>] - <span class="hljs-number">41</span> + v4] == <span class="hljs-string">&#x27;1&#x27;</span> )<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span> ( v7[<span class="hljs-number">5</span> * *(_DWORD *)&amp;v3[<span class="hljs-number">25</span>] - <span class="hljs-number">41</span> + v4] == <span class="hljs-string">&#x27;#&#x27;</span> )<br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;\nok, the order you enter is the flag!&quot;</span>);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>脑洞题，可以在49行和51行看出端倪，因为程序让我们以输入1234进行上下左右的操作，并且通过分析49和51行，可以猜出，这是一道走迷宫题，那么 “*11110100001010000101111#” 字符串就是迷宫，由于49和51行都是 *5操作，所以我们猜测迷宫是以五个数字为一行，遇到1则退出，遇到#则成功，迷宫如下</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-number">11110</span><br><span class="hljs-number">10000</span><br><span class="hljs-number">10100</span><br><span class="hljs-number">00101</span><br><span class="hljs-number">111</span>#<br></code></pre></td></tr></table></figure>

<p>所以flag：flag{22244114422}</p>
<h2 id="SimpleRev"><a href="#SimpleRev" class="headerlink" title="SimpleRev"></a>SimpleRev</h2><p>查壳</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211102201408371.png" alt="image-20211102201408371"></p>
<p>无壳，且为elf文件，使用ida64进行分析，查看伪代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> __cdecl __noreturn <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> v4; <span class="hljs-comment">// [rsp+Fh] [rbp-1h]</span><br><br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>    &#123;<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Welcome to CTF game!\nPlease input d/D to start or input q/Q to quit this program: &quot;</span>);<br>      v4 = <span class="hljs-built_in">getchar</span>();<br>      <span class="hljs-keyword">if</span> ( v4 != <span class="hljs-string">&#x27;d&#x27;</span> &amp;&amp; v4 != <span class="hljs-string">&#x27;D&#x27;</span> )<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-built_in">Decry</span>();<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v4 == <span class="hljs-string">&#x27;q&#x27;</span> || v4 == <span class="hljs-string">&#x27;Q&#x27;</span> )<br>      <span class="hljs-built_in">Exit</span>(<span class="hljs-string">&quot;Welcome to CTF game!\nPlease input d/D to start or input q/Q to quit this program: &quot;</span>, argv);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Input fault format!&quot;</span>);<br>    v3 = <span class="hljs-built_in">getchar</span>();<br>    <span class="hljs-built_in">putchar</span>(v3);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>猜测Decry()为加密函数，进入函数查看</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">unsigned</span> __int64 <span class="hljs-title">Decry</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">char</span> v1; <span class="hljs-comment">// [rsp+Fh] [rbp-51h]</span><br>  <span class="hljs-type">int</span> v2; <span class="hljs-comment">// [rsp+10h] [rbp-50h]</span><br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// [rsp+14h] [rbp-4Ch]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+18h] [rbp-48h]</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// [rsp+1Ch] [rbp-44h]</span><br>  <span class="hljs-type">char</span> src[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-40h] BYREF</span><br>  __int64 v7; <span class="hljs-comment">// [rsp+28h] [rbp-38h]</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [rsp+30h] [rbp-30h]</span><br>  __int64 v9[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-20h] BYREF</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [rsp+50h] [rbp-10h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v11; <span class="hljs-comment">// [rsp+58h] [rbp-8h]</span><br><br>  v11 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  *(_QWORD *)src = <span class="hljs-number">0x534C43444E</span>LL;  <span class="hljs-comment">//*(_QWORD *)src = &#x27;SLCDN&#x27;</span><br>  v7 = <span class="hljs-number">0LL</span>;<br>  v8 = <span class="hljs-number">0</span>;<br>  v9[<span class="hljs-number">0</span>] = <span class="hljs-number">0x776F646168</span>LL;   <span class="hljs-comment">//v9[0] = &#x27;wodah&#x27;</span><br>  v9[<span class="hljs-number">1</span>] = <span class="hljs-number">0LL</span>;              <span class="hljs-comment">//v9[1] = &#x27;\0&#x27;</span><br>  v10 = <span class="hljs-number">0</span>;<br>  text = (<span class="hljs-type">char</span> *)<span class="hljs-built_in">join</span>(key3, v9);   <span class="hljs-comment">//text：&#x27;killswodah\0&#x27;</span><br>  <span class="hljs-built_in">strcpy</span>(key, key1);               <span class="hljs-comment">//key：&#x27;ADSFK&#x27;</span><br>  <span class="hljs-built_in">strcat</span>(key, src);                <span class="hljs-comment">//key：&#x27;ADSFKSLCDN&#x27;</span><br>  v2 = <span class="hljs-number">0</span>;<br>  v3 = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">getchar</span>();<br>  v5 = <span class="hljs-built_in">strlen</span>(key);    <span class="hljs-comment">//10</span><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; v5; ++i )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( key[v3 % v5] &gt; <span class="hljs-number">64</span> &amp;&amp; key[v3 % v5] &lt;= <span class="hljs-number">90</span> )  <span class="hljs-comment">//这里因为%是求余符号，所以v3 % v5 = i</span><br>      key[i] = key[v3 % v5] + <span class="hljs-number">32</span>;  <span class="hljs-comment">//因此这个循环将key中的大写字母转换成小写字母</span><br>    ++v3;<br>  &#125;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Please input your flag:&quot;</span>);<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    v1 = <span class="hljs-built_in">getchar</span>();<br>    <span class="hljs-keyword">if</span> ( v1 == <span class="hljs-number">10</span> )  <span class="hljs-comment">//如果输入&#x27;\n&#x27;，则退出循环      </span><br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">if</span> ( v1 == <span class="hljs-number">32</span> )  <span class="hljs-comment">//如果输入&#x27; &#x27;，下标自增</span><br>    &#123;<br>      ++v2;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-keyword">if</span> ( v1 &lt;= <span class="hljs-number">96</span> || v1 &gt; <span class="hljs-number">122</span> )  <span class="hljs-comment">//如果不是小写字母</span><br>      &#123;<br>        <span class="hljs-keyword">if</span> ( v1 &gt; <span class="hljs-number">64</span> &amp;&amp; v1 &lt;= <span class="hljs-number">90</span> )    <span class="hljs-comment">//如果是大写字母</span><br>        &#123;<br>          str2[v2] = (v1 - <span class="hljs-number">39</span> - key[v3 % v5] + <span class="hljs-number">97</span>) % <span class="hljs-number">26</span> + <span class="hljs-number">97</span>;<br>          ++v3;<br>        &#125;   <span class="hljs-comment">//v1是我们输入的字符，v3是下标，v5是key的长度</span><br>      &#125;<br>      <span class="hljs-keyword">else</span>    <span class="hljs-comment">//如果是小写字母</span><br>      &#123;     <br>        str2[v2] = (v1 - <span class="hljs-number">39</span> - key[v3 % v5] + <span class="hljs-number">97</span>) % <span class="hljs-number">26</span> + <span class="hljs-number">97</span>;<br>        ++v3;<br>      &#125;<br>      <span class="hljs-keyword">if</span> ( !(v3 % v5) )<br>        <span class="hljs-built_in">putchar</span>(<span class="hljs-number">32</span>);<br>      ++v2;  <span class="hljs-comment">//str2下标自增</span><br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">strcmp</span>(text, str2) )  <span class="hljs-comment">//比较str2和text</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Congratulation!\n&quot;</span>);<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Try again!\n&quot;</span>);<br>  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v11;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>加密逻辑如上图注释，编写exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br>key=<span class="hljs-string">&quot;adsfkndcls&quot;</span><br>text=<span class="hljs-string">&quot;killshadow&quot;</span><br><br>flag=<span class="hljs-string">&quot;&quot;</span><br>loop=<span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span><br><br><br>v3 = <span class="hljs-number">0</span><br>v5 = <span class="hljs-built_in">len</span>(key)<br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(text)):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> loop:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">ord</span>(text[i])==(<span class="hljs-built_in">ord</span>(j)-<span class="hljs-number">39</span>-<span class="hljs-built_in">ord</span>(key[i])+<span class="hljs-number">97</span>)%<span class="hljs-number">26</span>+<span class="hljs-number">97</span>:<br>            flag+=j<br><br><span class="hljs-built_in">print</span> (<span class="hljs-string">&#x27;flag&#123;&#x27;</span>+flag+<span class="hljs-string">&#x27;&#125;&#x27;</span>)<br><br></code></pre></td></tr></table></figure>

<p>解出flag</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211102223919884.png" alt="image-20211102223919884"></p>
<p>flag：flag{KLDQCUDFZO}</p>
<h2 id="Java逆向解密"><a href="#Java逆向解密" class="headerlink" title="Java逆向解密"></a>Java逆向解密</h2><p>下载后是class文件，使用jadx进行反编译</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> defpackage;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.Scanner;<br><br><span class="hljs-comment">/* renamed from: Reverse  reason: default package */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Reverse</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);  <br>        System.out.println(<span class="hljs-string">&quot;Please input the flag ：&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> s.next();               <br>        System.out.println(<span class="hljs-string">&quot;Your input is ：&quot;</span>);<br>        System.out.println(str);<br>        Encrypt(str.toCharArray());<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Encrypt</span><span class="hljs-params">(<span class="hljs-type">char</span>[] arr)</span> &#123;<br>        <span class="hljs-type">int</span>[] KEY;<br>        ArrayList&lt;Integer&gt; Resultlist = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> c : arr) &#123;<br>            Resultlist.add(Integer.valueOf((c + <span class="hljs-string">&#x27;@&#x27;</span>) ^ <span class="hljs-number">32</span>));<br>        &#125;<br>        ArrayList&lt;Integer&gt; KEYList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i : <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;<span class="hljs-number">180</span>, <span class="hljs-number">136</span>, <span class="hljs-number">137</span>, <span class="hljs-number">147</span>, <span class="hljs-number">191</span>, <span class="hljs-number">137</span>, <span class="hljs-number">147</span>, <span class="hljs-number">191</span>, <span class="hljs-number">148</span>, <span class="hljs-number">136</span>, <span class="hljs-number">133</span>, <span class="hljs-number">191</span>, <span class="hljs-number">134</span>, <span class="hljs-number">140</span>, <span class="hljs-number">129</span>, <span class="hljs-number">135</span>, <span class="hljs-number">191</span>, <span class="hljs-number">65</span>&#125;) &#123;<br>            KEYList.add(Integer.valueOf(i));<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;Result:&quot;</span>);<br>        <span class="hljs-keyword">if</span> (Resultlist.equals(KEYList)) &#123;<br>            System.out.println(<span class="hljs-string">&quot;Congratulations！&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            System.err.println(<span class="hljs-string">&quot;Error！&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>有点看不懂，虽然可以选择百度一下函数的用法，但我选择换个工具试试~~</p>
<p>使用jd-gui反编译</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.Scanner;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Reverse</span> &#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    <span class="hljs-type">Scanner</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br>    System.out.println(<span class="hljs-string">&quot;Please input the flag );</span><br><span class="hljs-string">    String str = s.next();</span><br><span class="hljs-string">    System.out.println(&quot;</span>Your input is );<br>    System.out.println(str);<br>    <span class="hljs-type">char</span>[] stringArr = str.toCharArray();      <span class="hljs-comment">////将str字符串转换为stringArr字符数组</span><br>    Encrypt(stringArr);<br>  &#125;<br>  <br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Encrypt</span><span class="hljs-params">(<span class="hljs-type">char</span>[] arr)</span> &#123;<br>    ArrayList&lt;Integer&gt; Resultlist = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();  <br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; arr.length; i++) &#123;<br>      <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> arr[i] + <span class="hljs-number">64</span> ^ <span class="hljs-number">0x20</span>;       <span class="hljs-comment">//将输入的字符串  对result循环赋值（这里+的优先级大于^）</span><br>      Resultlist.add(Integer.valueOf(result));   <span class="hljs-comment">//result以整形add入Resultlist</span><br>    &#125; <br>    <span class="hljs-type">int</span>[] KEY = &#123; <br>        <span class="hljs-number">180</span>, <span class="hljs-number">136</span>, <span class="hljs-number">137</span>, <span class="hljs-number">147</span>, <span class="hljs-number">191</span>, <span class="hljs-number">137</span>, <span class="hljs-number">147</span>, <span class="hljs-number">191</span>, <span class="hljs-number">148</span>, <span class="hljs-number">136</span>, <br>        <span class="hljs-number">133</span>, <span class="hljs-number">191</span>, <span class="hljs-number">134</span>, <span class="hljs-number">140</span>, <span class="hljs-number">129</span>, <span class="hljs-number">135</span>, <span class="hljs-number">191</span>, <span class="hljs-number">65</span> &#125;;<br>    ArrayList&lt;Integer&gt; KEYList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; KEY.length; j++)<br>      KEYList.add(Integer.valueOf(KEY[j]));    <span class="hljs-comment">//KEY以整形add入KEYList.</span><br>    System.out.println(<span class="hljs-string">&quot;Result:&quot;</span>);<br>    <span class="hljs-keyword">if</span> (Resultlist.equals(KEYList)) &#123;        <span class="hljs-comment">//判断Resultlist和KEYList是否相等</span><br>      System.out.println(<span class="hljs-string">&quot;Congratulations);</span><br><span class="hljs-string">    &#125; else &#123;</span><br><span class="hljs-string">      System.err.println(&quot;</span>Error);<br>    &#125; <br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>好的现在能看懂了</p>
<p>编写exp爆破</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br> key = [<span class="hljs-number">180</span>, <span class="hljs-number">136</span>, <span class="hljs-number">137</span>, <span class="hljs-number">147</span>, <span class="hljs-number">191</span>, <span class="hljs-number">137</span>, <span class="hljs-number">147</span>, <span class="hljs-number">191</span>, <span class="hljs-number">148</span>, <span class="hljs-number">136</span>, <span class="hljs-number">133</span>, <span class="hljs-number">191</span>, <span class="hljs-number">134</span>, <span class="hljs-number">140</span>, <span class="hljs-number">129</span>, <span class="hljs-number">135</span>, <span class="hljs-number">191</span>, <span class="hljs-number">65</span> ]<br> flag = <span class="hljs-string">&quot;&quot;</span><br> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(key)):<br>     <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1024</span>):<br>         temp = x + <span class="hljs-number">64</span> ^ <span class="hljs-number">0x20</span><br>         <span class="hljs-keyword">if</span> temp == key[i]:<br>             flag += <span class="hljs-built_in">chr</span>(x)<br>             <span class="hljs-keyword">continue</span><br> <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;flag&#123;&quot;</span>+flag+<span class="hljs-string">&quot;&#125;&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>解出flag</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211103131714229.png" alt="image-20211103131714229"></p>
<p>flag：flag{This_is_the_flag_!}</p>
<h2 id="GXYCTF2019-luck-guy"><a href="#GXYCTF2019-luck-guy" class="headerlink" title="[GXYCTF2019]luck_guy"></a>[GXYCTF2019]luck_guy</h2><p>查壳</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211103132627494.png" alt="image-20211103132627494"></p>
<p>ELF文件，使用ida进行分析</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v4; <span class="hljs-comment">// [rsp+14h] [rbp-Ch] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 v5; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><br><br>  v5 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-built_in">welcome</span>(argc, argv, envp);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;_________________&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;try to patch me and find flag&quot;</span>);<br>  v4 = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;please input a lucky number&quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%d&quot;</span>, &amp;v4);<br>  <span class="hljs-built_in">patch_me</span>(v4);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;OK,see you again&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>进入patch_me（）函数查看</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> __fastcall <span class="hljs-title">patch_me</span><span class="hljs-params">(<span class="hljs-type">int</span> a1)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br><br>  <span class="hljs-keyword">if</span> ( a1 % <span class="hljs-number">2</span> == <span class="hljs-number">1</span> )<br>    result = <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;just finished&quot;</span>);<br>  <span class="hljs-keyword">else</span><br>    result = <span class="hljs-built_in">get_flag</span>();<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>进入get_flag（）函数查看</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">unsigned</span> __int64 <span class="hljs-title">get_flag</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v0; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+4h] [rbp-3Ch]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+8h] [rbp-38h]</span><br>  __int64 s; <span class="hljs-comment">// [rsp+10h] [rbp-30h] BYREF</span><br>  <span class="hljs-type">char</span> v5; <span class="hljs-comment">// [rsp+18h] [rbp-28h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v6; <span class="hljs-comment">// [rsp+38h] [rbp-8h]</span><br><br>  v6 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  v0 = <span class="hljs-built_in">time</span>(<span class="hljs-number">0LL</span>);<br>  <span class="hljs-built_in">srand</span>(v0);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">4</span>; ++i )<br>  &#123;<br>    <span class="hljs-keyword">switch</span> ( <span class="hljs-built_in">rand</span>() % <span class="hljs-number">200</span> )<br>    &#123;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;OK, it&#x27;s flag:&quot;</span>);<br>        <span class="hljs-built_in">memset</span>(&amp;s, <span class="hljs-number">0</span>, <span class="hljs-number">0x28</span>uLL);<br>        <span class="hljs-built_in">strcat</span>((<span class="hljs-type">char</span> *)&amp;s, f1);  <span class="hljs-comment">//f1：GXY&#123;do_not_</span><br>        <span class="hljs-built_in">strcat</span>((<span class="hljs-type">char</span> *)&amp;s, &amp;f2);  <span class="hljs-comment">//f2未初始化 s = f1 + f2</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>, (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)&amp;s);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Solar not like you&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Solar want a girlfriend&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>        s = <span class="hljs-number">0x7F666F6067756369</span>LL;  <span class="hljs-comment">// s = &#x27;\x7Ffoguci&#x27;</span><br>        v5 = <span class="hljs-number">0</span>;<br>        <span class="hljs-built_in">strcat</span>(&amp;f2, (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)&amp;s);  <span class="hljs-comment">//初始化f2</span><br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:<br>        <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">7</span>; ++j )  <span class="hljs-comment">//对f2循环赋值</span><br>        &#123;<br>          <span class="hljs-keyword">if</span> ( j % <span class="hljs-number">2</span> == <span class="hljs-number">1</span> )<br>            *(&amp;f2 + j) -= <span class="hljs-number">2</span>;<br>          <span class="hljs-keyword">else</span><br>            --*(&amp;f2 + j);<br>        &#125;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">default</span>:<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;emmm,you can&#x27;t find flag 23333&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> __readfsqword(<span class="hljs-number">0x28</span>u) ^ v6;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>逻辑已经很清楚了，编写exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br>f1 = <span class="hljs-string">&quot;GXY&#123;do_not_&quot;</span><br>f2 = <span class="hljs-string">&quot;icug`of&quot;</span> <span class="hljs-comment">#千万注意ida中的字符是反向存储的</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">7</span>):<br>    <span class="hljs-keyword">if</span> i%<span class="hljs-number">2</span> == <span class="hljs-number">1</span>:<br>        f1 += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(f2[i]) - <span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">else</span>:<br>        f1 += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(f2[i]) - <span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(f1)<br></code></pre></td></tr></table></figure>

<p>输出flag</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211103140620774.png" alt="image-20211103140620774"></p>
<p>……咱也不知道为什么少了个 ‘}’</p>
<p>flag：GXY{do_not_hate_me}</p>
<h2 id="刮开有奖"><a href="#刮开有奖" class="headerlink" title="刮开有奖"></a>刮开有奖</h2><p>查壳</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211103150108846.png" alt="image-20211103150108846"></p>
<p>无壳，尝试运行程序，弹出弹窗</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211103150153406.png" alt="image-20211103150153406"></p>
<p>使用ida进行分析，定位到关键函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">INT_PTR __stdcall <span class="hljs-title">DialogFunc</span><span class="hljs-params">(HWND hDlg, UINT a2, WPARAM a3, LPARAM a4)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v4; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v5; <span class="hljs-comment">// edi</span><br>  <span class="hljs-type">int</span> v7[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [esp+8h] [ebp-20030h] BYREF</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [esp+10h] [ebp-20028h]</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [esp+14h] [ebp-20024h]</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [esp+18h] [ebp-20020h]</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// [esp+1Ch] [ebp-2001Ch]</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// [esp+20h] [ebp-20018h]</span><br>  <span class="hljs-type">int</span> v13; <span class="hljs-comment">// [esp+24h] [ebp-20014h]</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// [esp+28h] [ebp-20010h]</span><br>  <span class="hljs-type">int</span> v15; <span class="hljs-comment">// [esp+2Ch] [ebp-2000Ch]</span><br>  <span class="hljs-type">int</span> v16; <span class="hljs-comment">// [esp+30h] [ebp-20008h]</span><br>  CHAR String[<span class="hljs-number">65536</span>]; <span class="hljs-comment">// [esp+34h] [ebp-20004h] BYREF</span><br>  <span class="hljs-type">char</span> v18[<span class="hljs-number">65536</span>]; <span class="hljs-comment">// [esp+10034h] [ebp-10004h] BYREF</span><br><br>  <span class="hljs-keyword">if</span> ( a2 == <span class="hljs-number">272</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> ( a2 != <span class="hljs-number">273</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> ( (_WORD)a3 == <span class="hljs-number">1001</span> )<br>  &#123;<br>    <span class="hljs-built_in">memset</span>(String, <span class="hljs-number">0</span>, <span class="hljs-number">0xFFFF</span>u);<br>    <span class="hljs-built_in">GetDlgItemTextA</span>(hDlg, <span class="hljs-number">1000</span>, String, <span class="hljs-number">0xFFFF</span>);<span class="hljs-comment">//输入为str</span><br>    <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(String) == <span class="hljs-number">8</span> )<br>    &#123;<br>      v7[<span class="hljs-number">0</span>] = <span class="hljs-number">90</span>;<br>      v7[<span class="hljs-number">1</span>] = <span class="hljs-number">74</span>;<br>      v8 = <span class="hljs-number">83</span>;<br>      v9 = <span class="hljs-number">69</span>;<br>      v10 = <span class="hljs-number">67</span>;<br>      v11 = <span class="hljs-number">97</span>;<br>      v12 = <span class="hljs-number">78</span>;<br>      v13 = <span class="hljs-number">72</span>;<br>      v14 = <span class="hljs-number">51</span>;<br>      v15 = <span class="hljs-number">110</span>;<br>      v16 = <span class="hljs-number">103</span>; <span class="hljs-comment">//以v7为首地址初始化一个数组</span><br>      <span class="hljs-built_in">sub_4010F0</span>((<span class="hljs-type">int</span>)v7, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>); <span class="hljs-comment">//变化v7数组</span><br>      <span class="hljs-built_in">memset</span>(v18, <span class="hljs-number">0</span>, <span class="hljs-number">0xFFFF</span>u);<br>      v18[<span class="hljs-number">0</span>] = String[<span class="hljs-number">5</span>];<br>      v18[<span class="hljs-number">2</span>] = String[<span class="hljs-number">7</span>];<br>      v18[<span class="hljs-number">1</span>] = String[<span class="hljs-number">6</span>];  <span class="hljs-comment">//v18存储str5-7</span><br>      v4 = <span class="hljs-built_in">sub_401000</span>((<span class="hljs-type">int</span>)v18, <span class="hljs-built_in">strlen</span>(v18)); <span class="hljs-comment">//根据里面的特征码，看出是标准base64加密</span><br>      <span class="hljs-built_in">memset</span>(v18, <span class="hljs-number">0</span>, <span class="hljs-number">0xFFFF</span>u);<br>      v18[<span class="hljs-number">1</span>] = String[<span class="hljs-number">3</span>];<br>      v18[<span class="hljs-number">0</span>] = String[<span class="hljs-number">2</span>];<br>      v18[<span class="hljs-number">2</span>] = String[<span class="hljs-number">4</span>];  <span class="hljs-comment">//v18存储str2-4</span><br>      v5 = <span class="hljs-built_in">sub_401000</span>((<span class="hljs-type">int</span>)v18, <span class="hljs-built_in">strlen</span>(v18));  <span class="hljs-comment">//梅开二度</span><br>      <span class="hljs-keyword">if</span> ( String[<span class="hljs-number">0</span>] == v7[<span class="hljs-number">0</span>] + <span class="hljs-number">34</span><br>        &amp;&amp; String[<span class="hljs-number">1</span>] == v10<br>        &amp;&amp; <span class="hljs-number">4</span> * String[<span class="hljs-number">2</span>] - <span class="hljs-number">141</span> == <span class="hljs-number">3</span> * v8<br>        &amp;&amp; String[<span class="hljs-number">3</span>] / <span class="hljs-number">4</span> == <span class="hljs-number">2</span> * (v13 / <span class="hljs-number">9</span>)<br>        &amp;&amp; !<span class="hljs-built_in">strcmp</span>(v4, <span class="hljs-string">&quot;ak1w&quot;</span>)<br>        &amp;&amp; !<span class="hljs-built_in">strcmp</span>(v5, <span class="hljs-string">&quot;V1Ax&quot;</span>) )<br>      &#123;<br>        <span class="hljs-built_in">MessageBoxA</span>(hDlg, <span class="hljs-string">&quot;U g3t 1T!&quot;</span>, <span class="hljs-string">&quot;@_@&quot;</span>, <span class="hljs-number">0</span>);<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( (_WORD)a3 != <span class="hljs-number">1</span> &amp;&amp; (_WORD)a3 != <span class="hljs-number">2</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">EndDialog</span>(hDlg, (<span class="hljs-type">unsigned</span> __int16)a3);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>可以看出，算法大概分为三部分，对v7数组进行变化、base64加密、flag校验</p>
<p>我们看看 sub_4010F0 是如何对v7数组进行变换的</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> __cdecl <span class="hljs-title">sub_EF10F0</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> a2, <span class="hljs-type">int</span> a3)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax   //v7 0 10</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// edx</span><br><br>  result = a3;  <span class="hljs-comment">//result = 10</span><br>  <span class="hljs-keyword">for</span> ( i = a2; i &lt;= a3; a2 = i )<br>  &#123;<br>    v5 = <span class="hljs-number">4</span> * i;<br>    v6 = *(_DWORD *)(<span class="hljs-number">4</span> * i + a1);  <span class="hljs-comment">//v6 = v7[i]</span><br>    <span class="hljs-keyword">if</span> ( a2 &lt; result &amp;&amp; i &lt; result )<br>    &#123;<br>      <span class="hljs-keyword">do</span><br>      &#123;<br>        <span class="hljs-keyword">if</span> ( v6 &gt; *(_DWORD *)(a1 + <span class="hljs-number">4</span> * result) )  <span class="hljs-comment">//if(v7[i]&gt;v7[最后一位])</span><br>        &#123;<br>          <span class="hljs-keyword">if</span> ( i &gt;= result )<br>            <span class="hljs-keyword">break</span>;<br>          ++i;<br>          *(_DWORD *)(v5 + a1) = *(_DWORD *)(a1 + <span class="hljs-number">4</span> * result); <span class="hljs-comment">//v7[i] = v7[最后一位]</span><br>          <span class="hljs-keyword">if</span> ( i &gt;= result )<br>            <span class="hljs-keyword">break</span>;<br>          <span class="hljs-keyword">while</span> ( *(_DWORD *)(a1 + <span class="hljs-number">4</span> * i) &lt;= v6 )<br>          &#123;<br>            <span class="hljs-keyword">if</span> ( ++i &gt;= result )<br>              <span class="hljs-keyword">goto</span> LABEL_13;<br>          &#125;<br>          <span class="hljs-keyword">if</span> ( i &gt;= result )<br>            <span class="hljs-keyword">break</span>;<br>          v5 = <span class="hljs-number">4</span> * i;<br>          *(_DWORD *)(a1 + <span class="hljs-number">4</span> * result) = *(_DWORD *)(<span class="hljs-number">4</span> * i + a1);  <span class="hljs-comment">//v7[最后一位] =  v7[i]</span><br>        &#125;<br>        --result;  <span class="hljs-comment">//最后一位下标自减</span><br>      &#125;<br>      <span class="hljs-keyword">while</span> ( i &lt; result );<br>    &#125;<br>LABEL_13:<br>    *(_DWORD *)(a1 + <span class="hljs-number">4</span> * result) = v6;<br>    <span class="hljs-built_in">sub_EF10F0</span>(a1, a2, i - <span class="hljs-number">1</span>);<br>    result = a3;<br>    ++i;<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>转换成c语言执行</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs c++"> <span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span></span><br> <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sub_40</span><span class="hljs-params">(<span class="hljs-type">int</span> a[<span class="hljs-number">10</span>],<span class="hljs-type">int</span> a2,<span class="hljs-type">int</span> a3)</span></span><br><span class="hljs-function"> </span>&#123;<br><span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br> <span class="hljs-type">int</span> i; <span class="hljs-comment">// esi</span><br> <span class="hljs-type">int</span> v5; <span class="hljs-comment">// ecx</span><br> <span class="hljs-type">int</span> v6; <span class="hljs-comment">// edx</span><br>result = a3;<br> <span class="hljs-keyword">for</span> ( i = a2; i &lt;= a3; a2 = i )<br> &#123;<br>   v5 = i;<br>   v6 = a[i];<br>   <span class="hljs-keyword">if</span> ( a2 &lt; result &amp;&amp; i &lt; result )<br>   &#123;<br>     <span class="hljs-keyword">do</span><br>     &#123;<br>       <span class="hljs-keyword">if</span> ( v6 &gt; a[result] )<br>       &#123;<br>         <span class="hljs-keyword">if</span> ( i &gt;= result )<br>           <span class="hljs-keyword">break</span>;<br>         ++i;<br>         a[v5] = a[result];<br>         <span class="hljs-keyword">if</span> ( i &gt;= result )<br>           <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">while</span> ( a[i] &lt;= v6 )<br>         &#123;<br>           <span class="hljs-keyword">if</span> ( ++i &gt;= result )<br>             <span class="hljs-keyword">goto</span> LABEL_13;<br>         &#125;<br>         <span class="hljs-keyword">if</span> ( i &gt;= result )<br>           <span class="hljs-keyword">break</span>;<br>         v5 = i;<br>        a[result] = a[i];<br>       &#125;<br>       --result;<br>     &#125;<br>     <span class="hljs-keyword">while</span> ( i &lt; result );<br>   &#125;<br>  LABEL_13:<br>  a[result] = v6;<br>   <span class="hljs-built_in">sub_40</span>(a, a2, i - <span class="hljs-number">1</span>);<br>   result = a3;<br>   ++i;<br>  	&#125;<br> 	<span class="hljs-keyword">return</span> result;<br> &#125;<br> <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"> </span>&#123;<br> 	<span class="hljs-type">int</span> i;<br> 	<span class="hljs-type">int</span> a[<span class="hljs-number">20</span>]=&#123;<span class="hljs-number">90</span>,<span class="hljs-number">74</span>,<span class="hljs-number">83</span>,<span class="hljs-number">69</span>,<span class="hljs-number">67</span>,<span class="hljs-number">97</span>,<span class="hljs-number">78</span>,<span class="hljs-number">72</span>,<span class="hljs-number">51</span>,<span class="hljs-number">110</span>,<span class="hljs-number">103</span>&#125;;<br> 	<span class="hljs-built_in">sub_40</span>(a,<span class="hljs-number">0</span>,<span class="hljs-number">10</span>);<br> 	<span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">10</span>;i++)<br> 		<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%4c&quot;</span>,a[i]);<br> 	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br> 	<span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">10</span>;i++)<br> 		<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%4d&quot;</span>,a[i]);<br> 	<span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br> &#125;<br></code></pre></td></tr></table></figure>

<p>执行结果</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211118213657391.png" alt="image-20211118213657391"></p>
<p>可以看到，sub_4010F0函数将数组按升序排序</p>
<p>写出解密脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-keyword">import</span> base64<br>base_now=<span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;</span><br>base_init=<span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;</span><br>clear=<span class="hljs-string">&quot;V1Axak1w&quot;</span><br>c=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(clear)):<br>    b=base_now.find(clear[i])<br>    c+=base_init[b]<br>c=base64.b64decode(c)<br><span class="hljs-built_in">print</span> c<br></code></pre></td></tr></table></figure>

<p>flag：flag{UJWP1jMp}</p>
<h2 id="findit"><a href="#findit" class="headerlink" title="findit"></a>findit</h2><p>apk文件，jadx打开，找到关键代码位置</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211119133827162.png" alt="image-20211119133827162"></p>
<p>加密代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ActionBarActivity</span> &#123;<br>    <span class="hljs-comment">/* access modifiers changed from: protected */</span><br>    <span class="hljs-meta">@Override</span> <span class="hljs-comment">// android.support.p003v7.app.ActionBarActivity, android.support.p000v4.app.FragmentActivity</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(C0130R.layout.activity_main);<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">EditText</span> <span class="hljs-variable">edit</span> <span class="hljs-operator">=</span> (EditText) findViewById(C0130R.C0132id.widget2);<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">TextView</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> (TextView) findViewById(C0130R.C0132id.widget1);<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">char</span>[] a = &#123;<span class="hljs-string">&#x27;T&#x27;</span>, <span class="hljs-string">&#x27;h&#x27;</span>, <span class="hljs-string">&#x27;i&#x27;</span>, <span class="hljs-string">&#x27;s&#x27;</span>, <span class="hljs-string">&#x27;I&#x27;</span>, <span class="hljs-string">&#x27;s&#x27;</span>, <span class="hljs-string">&#x27;T&#x27;</span>, <span class="hljs-string">&#x27;h&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27;F&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;g&#x27;</span>, <span class="hljs-string">&#x27;H&#x27;</span>, <span class="hljs-string">&#x27;o&#x27;</span>, <span class="hljs-string">&#x27;m&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>&#125;;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">char</span>[] b = &#123;<span class="hljs-string">&#x27;p&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>, <span class="hljs-string">&#x27;k&#x27;</span>, <span class="hljs-string">&#x27;q&#x27;</span>, <span class="hljs-string">&#x27;&#123;&#x27;</span>, <span class="hljs-string">&#x27;m&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>, <span class="hljs-string">&#x27;7&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;m&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;9&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;n&#x27;</span>, <span class="hljs-string">&#x27;p&#x27;</span>, <span class="hljs-string">&#x27;7&#x27;</span>, <span class="hljs-string">&#x27;p&#x27;</span>, <span class="hljs-string">&#x27;9&#x27;</span>, <span class="hljs-string">&#x27;m&#x27;</span>, <span class="hljs-string">&#x27;n&#x27;</span>, <span class="hljs-string">&#x27;k&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;8&#x27;</span>, <span class="hljs-string">&#x27;k&#x27;</span>, <span class="hljs-string">&#x27;7&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;&#125;&#x27;</span>&#125;;<br>        ((Button) findViewById(C0130R.C0132id.widget3)).setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnClickListener() &#123;<br>            <span class="hljs-comment">/* class com.example.findit.MainActivity.View$OnClickListenerC01291 */</span><br><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> &#123;<br>                <span class="hljs-type">char</span>[] x = <span class="hljs-keyword">new</span> <span class="hljs-title class_">char</span>[<span class="hljs-number">17</span>];<br>                <span class="hljs-type">char</span>[] y = <span class="hljs-keyword">new</span> <span class="hljs-title class_">char</span>[<span class="hljs-number">38</span>];<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">17</span>; i++) &#123;<br>                    <span class="hljs-keyword">if</span> ((a[i] &lt; <span class="hljs-string">&#x27;I&#x27;</span> &amp;&amp; a[i] &gt;= <span class="hljs-string">&#x27;A&#x27;</span>) || (a[i] &lt; <span class="hljs-string">&#x27;i&#x27;</span> &amp;&amp; a[i] &gt;= <span class="hljs-string">&#x27;a&#x27;</span>)) &#123;<br>                        x[i] = (<span class="hljs-type">char</span>) (a[i] + <span class="hljs-number">18</span>);<br>                    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((a[i] &lt; <span class="hljs-string">&#x27;A&#x27;</span> || a[i] &gt; <span class="hljs-string">&#x27;Z&#x27;</span>) &amp;&amp; (a[i] &lt; <span class="hljs-string">&#x27;a&#x27;</span> || a[i] &gt; <span class="hljs-string">&#x27;z&#x27;</span>)) &#123;<br>                        x[i] = a[i];<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        x[i] = (<span class="hljs-type">char</span>) (a[i] - <span class="hljs-string">&#x27;\b&#x27;</span>);<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">if</span> (String.valueOf(x).equals(edit.getText().toString())) &#123;<br>                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i2</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i2 &lt; <span class="hljs-number">38</span>; i2++) &#123;<br>                        <span class="hljs-keyword">if</span> ((b[i2] &lt; <span class="hljs-string">&#x27;A&#x27;</span> || b[i2] &gt; <span class="hljs-string">&#x27;Z&#x27;</span>) &amp;&amp; (b[i2] &lt; <span class="hljs-string">&#x27;a&#x27;</span> || b[i2] &gt; <span class="hljs-string">&#x27;z&#x27;</span>)) &#123;<br>                            y[i2] = b[i2];<br>                        &#125; <span class="hljs-keyword">else</span> &#123;<br>                            y[i2] = (<span class="hljs-type">char</span>) (b[i2] + <span class="hljs-number">16</span>);<br>                            <span class="hljs-keyword">if</span> ((y[i2] &gt; <span class="hljs-string">&#x27;Z&#x27;</span> &amp;&amp; y[i2] &lt; <span class="hljs-string">&#x27;a&#x27;</span>) || y[i2] &gt;= <span class="hljs-string">&#x27;z&#x27;</span>) &#123;<br>                                y[i2] = (<span class="hljs-type">char</span>) (y[i2] - <span class="hljs-number">26</span>);<br>                            &#125;<br>                        &#125;<br>                    &#125;<br>                    text.setText(String.valueOf(y));<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>                text.setText(<span class="hljs-string">&quot;答案错了肿么办。。。不给你又不好意思。。。哎呀好纠结啊~~~&quot;</span>);<br>            &#125;<br>        &#125;);<br>    &#125;<br><br></code></pre></td></tr></table></figure>

<p>脚本如下（其实就是列表转字符串）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">b = [<span class="hljs-string">&#x27;p&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>, <span class="hljs-string">&#x27;k&#x27;</span>, <span class="hljs-string">&#x27;q&#x27;</span>, <span class="hljs-string">&#x27;&#123;&#x27;</span>, <span class="hljs-string">&#x27;m&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>, <span class="hljs-string">&#x27;7&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;m&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;9&#x27;</span>, <span class="hljs-string">&#x27;l&#x27;</span>, <span class="hljs-string">&#x27;n&#x27;</span>, <span class="hljs-string">&#x27;p&#x27;</span>, <span class="hljs-string">&#x27;7&#x27;</span>, <span class="hljs-string">&#x27;p&#x27;</span>, <span class="hljs-string">&#x27;9&#x27;</span>, <span class="hljs-string">&#x27;m&#x27;</span>, <span class="hljs-string">&#x27;n&#x27;</span>, <span class="hljs-string">&#x27;k&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;8&#x27;</span>, <span class="hljs-string">&#x27;k&#x27;</span>, <span class="hljs-string">&#x27;7&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;&#125;&#x27;</span>]<br>flag = <span class="hljs-string">&#x27;&#x27;</span>.join(b)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure>

<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211119145236617.png" alt="image-20211119145236617"></p>
<p>flag：flag{m164675262033l4m49lnp7p9mnk28k75}</p>
<h2 id="BJDCTF2020-JustRE"><a href="#BJDCTF2020-JustRE" class="headerlink" title="[BJDCTF2020]JustRE"></a>[BJDCTF2020]JustRE</h2><p>查壳</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211119135655415.png" alt="image-20211119135655415"></p>
<p>无壳，尝试运行</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211119135905798.png" alt="image-20211119135905798"></p>
<p>没有任何软用，ida32分析</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211119142841108.png" alt="image-20211119142841108"></p>
<p>看伪代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">INT_PTR __stdcall <span class="hljs-title">DialogFunc</span><span class="hljs-params">(HWND hWnd, UINT a2, WPARAM a3, LPARAM a4)</span></span><br><span class="hljs-function"></span>&#123;<br>  CHAR String[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+0h] [ebp-64h] BYREF</span><br><br>  <span class="hljs-keyword">if</span> ( a2 != <span class="hljs-number">272</span> )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( a2 != <span class="hljs-number">273</span> )<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> ( (_WORD)a3 != <span class="hljs-number">1</span> &amp;&amp; (_WORD)a3 != <span class="hljs-number">2</span> )<br>    &#123;<br>      <span class="hljs-built_in">sprintf</span>(String, Format, ++dword_4099F0);<br>      <span class="hljs-keyword">if</span> ( dword_4099F0 == <span class="hljs-number">19999</span> )<br>      &#123;<br>        <span class="hljs-built_in">sprintf</span>(String, <span class="hljs-string">&quot; BJD&#123;%d%d2069a45792d233ac&#125;&quot;</span>, <span class="hljs-number">19999</span>, <span class="hljs-number">0</span>);<br>        <span class="hljs-built_in">SetWindowTextA</span>(hWnd, String);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>      &#125;<br>      <span class="hljs-built_in">SetWindowTextA</span>(hWnd, String);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-built_in">EndDialog</span>(hWnd, (<span class="hljs-type">unsigned</span> __int16)a3);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>看到字符串 %d%d2069a45792d233ac ，后面还传了个19999和0，直接猜一手，把%d%d换成19999和0</p>
<p>flag：flag{1999902069a45792d233ac}</p>
<p>实际上本题的正常逻辑，是点击19999次会弹出如下对话框</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211119143742009.png" alt="image-20211119143742009"></p>
<p>那么我们可以OD动调绕过，或者直接连点器（不是）</p>
<h2 id="简单注册器"><a href="#简单注册器" class="headerlink" title="简单注册器"></a>简单注册器</h2><p>apk文件，jadx分析</p>
<p>关键代码位置</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211119144637390.png" alt="image-20211119144637390"></p>
<p>关键代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> &#123;<br>                <span class="hljs-type">int</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>                <span class="hljs-type">String</span> <span class="hljs-variable">xx</span> <span class="hljs-operator">=</span> editview.getText().toString();<br>                <span class="hljs-keyword">if</span> (!(xx.length() == <span class="hljs-number">32</span> &amp;&amp; xx.charAt(<span class="hljs-number">31</span>) == <span class="hljs-string">&#x27;a&#x27;</span> &amp;&amp; xx.charAt(<span class="hljs-number">1</span>) == <span class="hljs-string">&#x27;b&#x27;</span> &amp;&amp; (xx.charAt(<span class="hljs-number">0</span>) + xx.charAt(<span class="hljs-number">2</span>)) - <span class="hljs-number">48</span> == <span class="hljs-number">56</span>)) &#123;<br>                    flag = <span class="hljs-number">0</span>;<br>                &#125;<br>                <span class="hljs-keyword">if</span> (flag == <span class="hljs-number">1</span>) &#123;<br>                    <span class="hljs-type">char</span>[] x = <span class="hljs-string">&quot;dd2940c04462b4dd7c450528835cca15&quot;</span>.toCharArray();<br>                    x[<span class="hljs-number">2</span>] = (<span class="hljs-type">char</span>) ((x[<span class="hljs-number">2</span>] + x[<span class="hljs-number">3</span>]) - <span class="hljs-number">50</span>);<br>                    x[<span class="hljs-number">4</span>] = (<span class="hljs-type">char</span>) ((x[<span class="hljs-number">2</span>] + x[<span class="hljs-number">5</span>]) - <span class="hljs-number">48</span>);<br>                    x[<span class="hljs-number">30</span>] = (<span class="hljs-type">char</span>) ((x[<span class="hljs-number">31</span>] + x[<span class="hljs-number">9</span>]) - <span class="hljs-number">48</span>);<br>                    x[<span class="hljs-number">14</span>] = (<span class="hljs-type">char</span>) ((x[<span class="hljs-number">27</span>] + x[<span class="hljs-number">28</span>]) - <span class="hljs-number">97</span>);<br>                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) &#123;<br>                        <span class="hljs-type">char</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> x[<span class="hljs-number">31</span> - i];<br>                        x[<span class="hljs-number">31</span> - i] = x[i];<br>                        x[i] = a;<br>                    &#125;<br>                    textview.setText(<span class="hljs-string">&quot;flag&#123;&quot;</span> + String.valueOf(x) + <span class="hljs-string">&quot;&#125;&quot;</span>);<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br></code></pre></td></tr></table></figure>

<p>可以在ide里跑，但我写了个脚本，也差不多</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">x = <span class="hljs-string">&quot;dd2940c04462b4dd7c450528835cca15&quot;</span><br>lx = <span class="hljs-built_in">list</span>(x)<br>lx[<span class="hljs-number">2</span>] = <span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(lx[<span class="hljs-number">2</span>]) + <span class="hljs-built_in">ord</span>(lx[<span class="hljs-number">3</span>])) - <span class="hljs-number">50</span>)<br>lx[<span class="hljs-number">4</span>] = <span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(lx[<span class="hljs-number">2</span>]) + <span class="hljs-built_in">ord</span>(lx[<span class="hljs-number">5</span>])) - <span class="hljs-number">48</span>)<br>lx[<span class="hljs-number">30</span>] = <span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(lx[<span class="hljs-number">31</span>]) + <span class="hljs-built_in">ord</span>(lx[<span class="hljs-number">9</span>])) - <span class="hljs-number">48</span>)<br>lx[<span class="hljs-number">14</span>] = <span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(lx[<span class="hljs-number">27</span>]) + <span class="hljs-built_in">ord</span>(lx[<span class="hljs-number">28</span>])) - <span class="hljs-number">97</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">16</span>):<br>    a = lx[<span class="hljs-number">31</span>-i]<br>    lx[<span class="hljs-number">31</span>-i] = lx[i]<br>    lx[i] = a<br>flag = <span class="hljs-string">&#x27;&#x27;</span>.join(lx)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure>

<p>输出如下</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211119150408078.png" alt="image-20211119150408078"></p>
<p>flag：flag{59acc538825054c7de4b26440c0999dd}</p>
<h2 id="GWCTF-2019-pyre"><a href="#GWCTF-2019-pyre" class="headerlink" title="[GWCTF 2019]pyre"></a>[GWCTF 2019]pyre</h2><p>下载附件，是pyc文件，可以在线反编译</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># visit https://tool.lu/pyc/ for more information</span><br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;Welcome to Re World!&#x27;</span><br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;Your input1 is your flag~&#x27;</span><br>code =[<span class="hljs-string">&#x27;\x1f&#x27;</span>,<span class="hljs-string">&#x27;\x12&#x27;</span>,<span class="hljs-string">&#x27;\x1d&#x27;</span>,<span class="hljs-string">&#x27;(&#x27;</span>,<span class="hljs-string">&#x27;0&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;\x01&#x27;</span>,<span class="hljs-string">&#x27;\x06&#x27;</span>,<span class="hljs-string">&#x27;\x14&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;,&#x27;</span><br>       ,<span class="hljs-string">&#x27;\x1b&#x27;</span>,<span class="hljs-string">&#x27;U&#x27;</span>,<span class="hljs-string">&#x27;?&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;6&#x27;</span>,<span class="hljs-string">&#x27;*&#x27;</span>,<span class="hljs-string">&#x27;:&#x27;</span>,<span class="hljs-string">&#x27;\x01&#x27;</span>,<span class="hljs-string">&#x27;D&#x27;</span>,<span class="hljs-string">&#x27;;&#x27;</span>,<span class="hljs-string">&#x27;%&#x27;</span>,<span class="hljs-string">&#x27;\x13&#x27;</span>]<br>l = <span class="hljs-built_in">len</span>(input1)        <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(l):<br>    num = ((input1[i] + i) % <span class="hljs-number">128</span> + <span class="hljs-number">128</span>) % <span class="hljs-number">128</span><br>    code += num<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(l - <span class="hljs-number">1</span>):<br>    code[i] = code[i] ^ code[i + <span class="hljs-number">1</span>]<br><br><span class="hljs-built_in">print</span> code<br></code></pre></td></tr></table></figure>

<p>写出解密脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">code = [<span class="hljs-string">&#x27;\x1f&#x27;</span>,<span class="hljs-string">&#x27;\x12&#x27;</span>,<span class="hljs-string">&#x27;\x1d&#x27;</span>,<span class="hljs-string">&#x27;(&#x27;</span>,<span class="hljs-string">&#x27;0&#x27;</span>,<br>    <span class="hljs-string">&#x27;4&#x27;</span>,<span class="hljs-string">&#x27;\x01&#x27;</span>,<span class="hljs-string">&#x27;\x06&#x27;</span>,<span class="hljs-string">&#x27;\x14&#x27;</span>,<span class="hljs-string">&#x27;4&#x27;</span>,<br>    <span class="hljs-string">&#x27;,&#x27;</span>,<span class="hljs-string">&#x27;\x1b&#x27;</span>,<span class="hljs-string">&#x27;U&#x27;</span>,<span class="hljs-string">&#x27;?&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>,<span class="hljs-string">&#x27;6&#x27;</span>,<br>    <span class="hljs-string">&#x27;*&#x27;</span>,<span class="hljs-string">&#x27;:&#x27;</span>,<span class="hljs-string">&#x27;\x01&#x27;</span>,<span class="hljs-string">&#x27;D&#x27;</span>,<span class="hljs-string">&#x27;;&#x27;</span>,<span class="hljs-string">&#x27;%&#x27;</span>,<span class="hljs-string">&#x27;\x13&#x27;</span>]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(code)-<span class="hljs-number">2</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>    code[i] = <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(code[i])^<span class="hljs-built_in">ord</span>(code[i+<span class="hljs-number">1</span>]))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(code)):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(code[i])-i)%<span class="hljs-number">128</span>),end=<span class="hljs-string">&quot;&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>输出如下</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211119160451914.png" alt="image-20211119160451914"></p>
<h2 id="ACTF新生赛2020-easyre"><a href="#ACTF新生赛2020-easyre" class="headerlink" title="[ACTF新生赛2020]easyre"></a>[ACTF新生赛2020]easyre</h2><p>查壳</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211119211139390.png" alt="image-20211119211139390"></p>
<p>UPX壳，使用官方UPX脱壳</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211119211326993.png" alt="image-20211119211326993"></p>
<p>ida看伪码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  _BYTE v4[<span class="hljs-number">12</span>]; <span class="hljs-comment">// [esp+12h] [ebp-2Eh] BYREF</span><br>  _DWORD v5[<span class="hljs-number">3</span>]; <span class="hljs-comment">// [esp+1Eh] [ebp-22h]</span><br>  _BYTE v6[<span class="hljs-number">5</span>]; <span class="hljs-comment">// [esp+2Ah] [ebp-16h] BYREF</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// [esp+2Fh] [ebp-11h]</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [esp+33h] [ebp-Dh]</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [esp+37h] [ebp-9h]</span><br>  <span class="hljs-type">char</span> v10; <span class="hljs-comment">// [esp+3Bh] [ebp-5h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+3Ch] [ebp-4h]</span><br><br>  __main();<br>  <span class="hljs-built_in">qmemcpy</span>(v4, <span class="hljs-string">&quot;*F&#x27;\&quot;N,\&quot;(I?+@&quot;</span>, <span class="hljs-built_in">sizeof</span>(v4)); <span class="hljs-comment">//V4 = &quot;*F&#x27;\&quot;N,\&quot;(I?+@&quot;</span><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Please input:&quot;</span>);<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, v6);<br>  <span class="hljs-keyword">if</span> ( v6[<span class="hljs-number">0</span>] != <span class="hljs-number">65</span> || v6[<span class="hljs-number">1</span>] != <span class="hljs-number">67</span> || v6[<span class="hljs-number">2</span>] != <span class="hljs-number">84</span> || v6[<span class="hljs-number">3</span>] != <span class="hljs-number">70</span> || v6[<span class="hljs-number">4</span>] != <span class="hljs-number">123</span> || v10 != <span class="hljs-number">125</span> ) <span class="hljs-comment">//v6 = &quot;ACTF&#123;&#125;&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  v5[<span class="hljs-number">0</span>] = v7;<br>  v5[<span class="hljs-number">1</span>] = v8;<br>  v5[<span class="hljs-number">2</span>] = v9;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">11</span>; ++i )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( v4[i] != _data_start__[*((<span class="hljs-type">char</span> *)v5 + i) - <span class="hljs-number">1</span>] )<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125; <span class="hljs-comment">//在 data 中寻找和 v4[i]-1 相同的值</span><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;You are correct!&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><em>data_start</em>_ 处数据</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211119211730954.png" alt="image-20211119211730954"></p>
<p>写脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">key = <span class="hljs-string">&#x27;~&#125;|&#123;zyxwvutsrqponmlkjihgfedcba`_^]\[ZYXWVUTSRQPONMLKJIHGFEDCBA@?&gt;=&lt;;:9876543210/.-,+*)(\&#x27;&amp;%$# !&quot;&#x27;</span> <span class="hljs-comment">#&#x27;一定要加\</span><br>encrypt = [<span class="hljs-number">42</span>,<span class="hljs-number">70</span>,<span class="hljs-number">39</span>,<span class="hljs-number">34</span>,<span class="hljs-number">78</span>,<span class="hljs-number">44</span>,<span class="hljs-number">34</span>,<span class="hljs-number">40</span>,<span class="hljs-number">73</span>,<span class="hljs-number">63</span>,<span class="hljs-number">43</span>,<span class="hljs-number">64</span>]<br>x = []<br>flag = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> encrypt:<br>  x.append(key.find(<span class="hljs-built_in">chr</span>(i))+<span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> x:<br>  flag += <span class="hljs-built_in">chr</span>(i)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure>

<p>输出</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211123182142248.png" alt="image-20211123182142248"></p>
<p>这里因为刚学了angr，想试一下用angr来解题</p>
<p>正确分支的地址：0x00401451</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211123175509069.png" alt="image-20211123175509069"></p>
<p>解题过程</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211123181144746.png" alt="image-20211123181144746"></p>
<p>经过了长达几分钟的爆破</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211123180800542.png" alt="image-20211123180800542"></p>
<p>真他mua的，无脑且好用66</p>
<p>flag：ACTF{U9X_1S_W6@T?}</p>
<h2 id="rsa"><a href="#rsa" class="headerlink" title="rsa"></a>rsa</h2><p>关于RSA加密，去看Re-crypto这篇博客</p>
<p>两个文件</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211123200324976.png" alt="image-20211123200324976"></p>
<p>先看公钥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">-----BEGIN PUBLIC KEY-----<br>MDwwDQYJKoZIhvcNAQEBBQADKwAwKAIhAMAzLFxkrkcYL2wch21CM2kQVFpY9+7+<br>/AvKr1rzQczdAgMBAAE=<br>-----END PUBLIC KEY-----<br></code></pre></td></tr></table></figure>

<p>利用<a target="_blank" rel="noopener" href="http://www.hiencode.com/pub_asys.html">这个网站</a>，来在线解析公钥</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211123201213420.png" alt="image-20211123201213420"></p>
<p>去<a target="_blank" rel="noopener" href="http://www.factordb.com/index.php">这个网站</a>，在线分解质数</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211123201609419-16376697705421.png" alt="image-20211123201609419"></p>
<p>（RSATools，狗都不用）</p>
<p>写脚本跑</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2 <br><span class="hljs-keyword">import</span> rsa <br> <br>e = <span class="hljs-number">65537</span><br>n = <span class="hljs-number">86934482296048119190666062003494800588905656017203025617216654058378322103517</span><br>p = <span class="hljs-number">285960468890451637935629440372639283459</span><br>q = <span class="hljs-number">304008741604601924494328155975272418463</span><br><br>phin = (q-<span class="hljs-number">1</span>)*(p-<span class="hljs-number">1</span>)<br><br>d = gmpy2.invert(e, phin)<br><br>key = rsa.PrivateKey(n, e, <span class="hljs-built_in">int</span>(d), p, q)<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;C:\\Users\\86186\\Desktop\\re-题集\\output\\flag.enc&quot;</span>, <span class="hljs-string">&quot;rb+&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    f = f.read()<br>    <span class="hljs-built_in">print</span>(rsa.decrypt(f, key))<br></code></pre></td></tr></table></figure>

<p>输出flag</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211123202218332.png" alt="image-20211123202218332"></p>
<p>flag：flag{decrypt_256}</p>
<h2 id="ACTF新生赛2020-rome"><a href="#ACTF新生赛2020-rome" class="headerlink" title="[ACTF新生赛2020]rome"></a>[ACTF新生赛2020]rome</h2><p>查壳</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211123224412143.png" alt="image-20211123224412143"></p>
<p>无壳，ida一把梭</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">func</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v1[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [esp+14h] [ebp-44h]</span><br>  <span class="hljs-type">unsigned</span> __int8 v2; <span class="hljs-comment">// [esp+24h] [ebp-34h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int8 v3; <span class="hljs-comment">// [esp+25h] [ebp-33h]</span><br>  <span class="hljs-type">unsigned</span> __int8 v4; <span class="hljs-comment">// [esp+26h] [ebp-32h]</span><br>  <span class="hljs-type">unsigned</span> __int8 v5; <span class="hljs-comment">// [esp+27h] [ebp-31h]</span><br>  <span class="hljs-type">unsigned</span> __int8 v6; <span class="hljs-comment">// [esp+28h] [ebp-30h]</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// [esp+29h] [ebp-2Fh]</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [esp+2Dh] [ebp-2Bh]</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [esp+31h] [ebp-27h]</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [esp+35h] [ebp-23h]</span><br>  <span class="hljs-type">unsigned</span> __int8 v11; <span class="hljs-comment">// [esp+39h] [ebp-1Fh]</span><br>  <span class="hljs-type">char</span> v12[<span class="hljs-number">29</span>]; <span class="hljs-comment">// [esp+3Bh] [ebp-1Dh] BYREF</span><br><br>  <span class="hljs-built_in">strcpy</span>(v12, <span class="hljs-string">&quot;Qsw3sj_lz4_Ujw@l&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Please input:&quot;</span>);<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, &amp;v2);<br>  result = v2;<br>  <span class="hljs-keyword">if</span> ( v2 == <span class="hljs-string">&#x27;A&#x27;</span> )<br>  &#123;<br>    result = v3;<br>    <span class="hljs-keyword">if</span> ( v3 == <span class="hljs-string">&#x27;C&#x27;</span> )<br>    &#123;<br>      result = v4;<br>      <span class="hljs-keyword">if</span> ( v4 == <span class="hljs-string">&#x27;T&#x27;</span> )<br>      &#123;<br>        result = v5;<br>        <span class="hljs-keyword">if</span> ( v5 == <span class="hljs-string">&#x27;F&#x27;</span> )<br>        &#123;<br>          result = v6;<br>          <span class="hljs-keyword">if</span> ( v6 == <span class="hljs-string">&#x27;&#123;&#x27;</span> )<br>          &#123;<br>            result = v11;<br>            <span class="hljs-keyword">if</span> ( v11 == <span class="hljs-string">&#x27;&#125;&#x27;</span> )<br>            &#123;<br>              v1[<span class="hljs-number">0</span>] = v7;     <span class="hljs-comment">//ACTF&#123;&#125;</span><br>              v1[<span class="hljs-number">1</span>] = v8;<br>              v1[<span class="hljs-number">2</span>] = v9;<br>              v1[<span class="hljs-number">3</span>] = v10;<br>              *(_DWORD *)&amp;v12[<span class="hljs-number">17</span>] = <span class="hljs-number">0</span>;<br>              <span class="hljs-keyword">while</span> ( *(<span class="hljs-type">int</span> *)&amp;v12[<span class="hljs-number">17</span>] &lt;= <span class="hljs-number">15</span> )  <span class="hljs-comment">//v12:Qsw3sj_lz4_Ujw@l</span><br>              &#123;   <span class="hljs-comment">//v12[17]是从0起的下标，等价于v1[i]</span><br>                <span class="hljs-keyword">if</span> ( *((<span class="hljs-type">char</span> *)v1 + *(_DWORD *)&amp;v12[<span class="hljs-number">17</span>]) &gt; <span class="hljs-string">&#x27;@&#x27;</span> &amp;&amp; *((<span class="hljs-type">char</span> *)v1 + *(_DWORD *)&amp;v12[<span class="hljs-number">17</span>]) &lt;= <span class="hljs-string">&#x27;Z&#x27;</span> )<br>                  *((_BYTE *)v1 + *(_DWORD *)&amp;v12[<span class="hljs-number">17</span>]) = (*((<span class="hljs-type">char</span> *)v1 + *(_DWORD *)&amp;v12[<span class="hljs-number">17</span>]) - <span class="hljs-number">51</span>) % <span class="hljs-number">26</span> + <span class="hljs-number">65</span>;<br>                <span class="hljs-keyword">if</span> ( *((<span class="hljs-type">char</span> *)v1 + *(_DWORD *)&amp;v12[<span class="hljs-number">17</span>]) &gt; <span class="hljs-string">&#x27;`&#x27;</span> &amp;&amp; *((<span class="hljs-type">char</span> *)v1 + *(_DWORD *)&amp;v12[<span class="hljs-number">17</span>]) &lt;= <span class="hljs-string">&#x27;z&#x27;</span> )<br>                  *((_BYTE *)v1 + *(_DWORD *)&amp;v12[<span class="hljs-number">17</span>]) = (*((<span class="hljs-type">char</span> *)v1 + *(_DWORD *)&amp;v12[<span class="hljs-number">17</span>]) - <span class="hljs-number">79</span>) % <span class="hljs-number">26</span> + <span class="hljs-number">97</span>;<br>                ++*(_DWORD *)&amp;v12[<span class="hljs-number">17</span>];<br>              &#125;<br>              *(_DWORD *)&amp;v12[<span class="hljs-number">17</span>] = <span class="hljs-number">0</span>; <span class="hljs-comment">//下标置0</span><br>              <span class="hljs-keyword">while</span> ( *(<span class="hljs-type">int</span> *)&amp;v12[<span class="hljs-number">17</span>] &lt;= <span class="hljs-number">15</span> )<br>              &#123;<br>                result = (<span class="hljs-type">unsigned</span> __int8)v12[*(_DWORD *)&amp;v12[<span class="hljs-number">17</span>]];<br>                <span class="hljs-keyword">if</span> ( *((_BYTE *)v1 + *(_DWORD *)&amp;v12[<span class="hljs-number">17</span>]) != (_BYTE)result )<br>                  <span class="hljs-keyword">return</span> result; <span class="hljs-comment">//判断变化后的串是否和Qsw3sj_lz4_Ujw@l相等</span><br>                ++*(_DWORD *)&amp;v12[<span class="hljs-number">17</span>];<br>              &#125;<br>              result = <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;You are correct!&quot;</span>);<br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>( *((char *)v1 + *(_DWORD *)&amp;v12[17])</code>这一大串，看着很吓人，实际上就是v1[i]</p>
<p>如果不理解就去好好看看指针，或者我写的<code>杂谈-数组寻址和指针寻址的区别</code></p>
<p>这里一开始把加密做了逆运算，不知道为什么结果不对，贴个错误的脚本，以后相通了再改</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">code = <span class="hljs-string">&#x27;Qsw3sj_lz4_Ujw@l&#x27;</span><br>list_code = <span class="hljs-built_in">list</span>(code)<br>flag = [<span class="hljs-number">0</span>]*<span class="hljs-number">26</span><br><span class="hljs-comment">#print(list_code)</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(code)):<br>    <span class="hljs-keyword">if</span> list_code[i]&gt;<span class="hljs-string">&#x27;`&#x27;</span> <span class="hljs-keyword">and</span> list_code[i]&lt;=<span class="hljs-string">&#x27;z&#x27;</span>:<br>      flag[i] = <span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(list_code[i]) - <span class="hljs-number">14</span>) % <span class="hljs-number">26</span>)<br>    <span class="hljs-keyword">if</span> list_code[i]&gt;<span class="hljs-string">&#x27;@&#x27;</span> <span class="hljs-keyword">and</span> list_code[i]&lt;=<span class="hljs-string">&#x27;Z&#x27;</span>:<br>      flag[i] = <span class="hljs-built_in">chr</span>((<span class="hljs-built_in">ord</span>(list_code[i]) - <span class="hljs-number">18</span>) % <span class="hljs-number">26</span>)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure>

<p>换种方法，穷举ascii来爆破</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">code = <span class="hljs-string">&#x27;Qsw3sj_lz4_Ujw@l&#x27;</span><br>flag = <span class="hljs-string">&quot;ACTF&#123;&quot;</span><br><span class="hljs-comment">#print(list_code)</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(code)):<br>  <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">128</span>):<br>    k = j<br>    <span class="hljs-keyword">if</span> k&gt;<span class="hljs-number">64</span> <span class="hljs-keyword">and</span> k&lt;=<span class="hljs-number">90</span>:<br>      k = (k - <span class="hljs-number">51</span>) % <span class="hljs-number">26</span> + <span class="hljs-number">65</span><br>    <span class="hljs-keyword">if</span> k&gt;<span class="hljs-number">96</span> <span class="hljs-keyword">and</span> k&lt;=<span class="hljs-number">122</span>:<br>      k = (k - <span class="hljs-number">79</span>) % <span class="hljs-number">26</span> + <span class="hljs-number">97</span><br>    <span class="hljs-keyword">if</span> k == <span class="hljs-built_in">ord</span>(code[i]):<br>      flag += <span class="hljs-built_in">chr</span>(j);<br><span class="hljs-built_in">print</span>(flag+<span class="hljs-string">&quot;&#125;&quot;</span>)<br><span class="hljs-comment">#flag:ACTF&#123;Cae3ar_th4_Gre@t&#125;</span><br></code></pre></td></tr></table></figure>

<h2 id="CrackRTF"><a href="#CrackRTF" class="headerlink" title="CrackRTF"></a>CrackRTF</h2><p>查壳</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211123202822788.png" alt="image-20211123202822788"></p>
<p>无壳，ida一把梭，看主函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main_0</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  DWORD v3; <span class="hljs-comment">// eax</span><br>  DWORD v4; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> Str[<span class="hljs-number">260</span>]; <span class="hljs-comment">// [esp+4Ch] [ebp-310h] BYREF</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// [esp+150h] [ebp-20Ch]</span><br>  <span class="hljs-type">char</span> String1[<span class="hljs-number">260</span>]; <span class="hljs-comment">// [esp+154h] [ebp-208h] BYREF</span><br>  <span class="hljs-type">char</span> Destination[<span class="hljs-number">260</span>]; <span class="hljs-comment">// [esp+258h] [ebp-104h] BYREF</span><br><br>  <span class="hljs-built_in">memset</span>(Destination, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(Destination));<br>  <span class="hljs-built_in">memset</span>(String1, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(String1));<br>  v7 = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pls input the first passwd(1): &quot;</span>);<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, Destination);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(Destination) != <span class="hljs-number">6</span> )<br>  &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Must be 6 characters!\n&quot;</span>);<br>    ExitProcess(<span class="hljs-number">0</span>);<br>  &#125;<br>  v7 = atoi(Destination);<br>  <span class="hljs-keyword">if</span> ( v7 &lt; <span class="hljs-number">100000</span> )<br>    ExitProcess(<span class="hljs-number">0</span>);  <span class="hljs-comment">//六位字符范围：100000-999999</span><br>  <span class="hljs-built_in">strcat</span>(Destination, <span class="hljs-string">&quot;@DBApp&quot;</span>); <span class="hljs-comment">//输入六位字符，并在后面cat-@DBApp</span><br>  v3 = <span class="hljs-built_in">strlen</span>(Destination);<br>  sub_40100A((BYTE *)Destination, v3, String1); <span class="hljs-comment">//sh1加密</span><br>  <span class="hljs-keyword">if</span> ( !_strcmpi(String1, <span class="hljs-string">&quot;6E32D0943418C2C33385BC35A1470250DD8923A9&quot;</span>) )<br>  &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;continue...\n\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;pls input the first passwd(2): &quot;</span>);<br>    <span class="hljs-built_in">memset</span>(Str, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(Str));<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, Str);<br>    <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(Str) != <span class="hljs-number">6</span> )<br>    &#123;<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Must be 6 characters!\n&quot;</span>);<br>      ExitProcess(<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-built_in">strcat</span>(Str, Destination); <span class="hljs-comment">//在6位密码后面cat-刚刚的12位字符</span><br>    <span class="hljs-built_in">memset</span>(String1, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(String1));<br>    v4 = <span class="hljs-built_in">strlen</span>(Str);<br>    sub_401019((BYTE *)Str, v4, String1); <span class="hljs-comment">//md5加密</span><br>    <span class="hljs-keyword">if</span> ( !_strcmpi(<span class="hljs-string">&quot;27019e688a4e62a649fd99cadaafdb4e&quot;</span>, String1) )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( !(<span class="hljs-type">unsigned</span> __int8)sub_40100F(Str) )<br>      &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Error!!\n&quot;</span>);<br>        ExitProcess(<span class="hljs-number">0</span>);<br>      &#125;<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;bye ~~\n&quot;</span>);<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>sub_40100A</code>函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_401230</span><span class="hljs-params">(BYTE *pbData, DWORD dwDataLen, LPSTR lpString1)</span><br>&#123;<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  DWORD i; <span class="hljs-comment">// [esp+4Ch] [ebp-28h]</span><br>  CHAR String2[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [esp+50h] [ebp-24h] BYREF</span><br>  BYTE v6[<span class="hljs-number">20</span>]; <span class="hljs-comment">// [esp+54h] [ebp-20h] BYREF</span><br>  DWORD pdwDataLen; <span class="hljs-comment">// [esp+68h] [ebp-Ch] BYREF</span><br>  HCRYPTHASH phHash; <span class="hljs-comment">// [esp+6Ch] [ebp-8h] BYREF</span><br>  HCRYPTPROV phProv; <span class="hljs-comment">// [esp+70h] [ebp-4h] BYREF</span><br><br>  <span class="hljs-keyword">if</span> ( !CryptAcquireContextA(&amp;phProv, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1u</span>, <span class="hljs-number">0xF0000000</span>) )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> ( CryptCreateHash(phProv, <span class="hljs-number">0x8004</span>u, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, &amp;phHash) )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( CryptHashData(phHash, pbData, dwDataLen, <span class="hljs-number">0</span>) )<br>    &#123;<br>      CryptGetHashParam(phHash, <span class="hljs-number">2u</span>, v6, &amp;pdwDataLen, <span class="hljs-number">0</span>);<br>      *lpString1 = <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; pdwDataLen; ++i )<br>      &#123;<br>        wsprintfA(String2, <span class="hljs-string">&quot;%02X&quot;</span>, v6[i]);<br>        lstrcatA(lpString1, String2);<br>      &#125;<br>      CryptDestroyHash(phHash);<br>      CryptReleaseContext(phProv, <span class="hljs-number">0</span>);<br>      result = <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      CryptDestroyHash(phHash);<br>      CryptReleaseContext(phProv, <span class="hljs-number">0</span>);<br>      result = <span class="hljs-number">0</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    CryptReleaseContext(phProv, <span class="hljs-number">0</span>);<br>    result = <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>可以看出是哈希加密，但不知道具体是哪一个，去查特征码（hash的第二个参数），<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/seccrypto/alg-id">去这里查</a></p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211123203552972.png" alt="image-20211123203552972"></p>
<p>好的，是sh1加密，去常用的<a href="%5BMD5%E5%85%8D%E8%B4%B9%E5%9C%A8%E7%BA%BF%E8%A7%A3%E5%AF%86%E7%A0%B4%E8%A7%A3_MD5%E5%9C%A8%E7%BA%BF%E5%8A%A0%E5%AF%86-SOMD5%5D(https://www.somd5.com/)">somd5</a>撞一下，碰碰运气</p>
<p>运气真好，诶嘿（</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211123204108474.png" alt="image-20211123204108474"></p>
<p>其实按照正常的流程，因为是六位密码，范围就是100000-999999，用hashlib包爆破</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><br>flag = <span class="hljs-string">&quot;@DBApp&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100000</span>,<span class="hljs-number">999999</span>):<br>	s = <span class="hljs-built_in">str</span>(i)+flag<br>	x = hashlib.sha1(s.encode())<br>	cnt = x.hexdigest()<br>	<span class="hljs-keyword">if</span> <span class="hljs-string">&quot;6e32d0943418c2c33385bc35a1470250dd8923a9&quot;</span> <span class="hljs-keyword">in</span> cnt:<br>		<span class="hljs-built_in">print</span>(cnt)<br>		<span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(i)+flag)<br></code></pre></td></tr></table></figure>

<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211123210204482.png" alt="image-20211123210204482"></p>
<p>那么我们的第一个密码就是123321</p>
<p><code>sub_401019</code>函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_401040</span><span class="hljs-params">(BYTE *pbData, DWORD dwDataLen, LPSTR lpString1)</span><br>&#123;<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  DWORD i; <span class="hljs-comment">// [esp+4Ch] [ebp-24h]</span><br>  CHAR String2[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [esp+50h] [ebp-20h] BYREF</span><br>  BYTE v6[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [esp+54h] [ebp-1Ch] BYREF</span><br>  DWORD pdwDataLen; <span class="hljs-comment">// [esp+64h] [ebp-Ch] BYREF</span><br>  HCRYPTHASH phHash; <span class="hljs-comment">// [esp+68h] [ebp-8h] BYREF</span><br>  HCRYPTPROV phProv; <span class="hljs-comment">// [esp+6Ch] [ebp-4h] BYREF</span><br><br>  <span class="hljs-keyword">if</span> ( !CryptAcquireContextA(&amp;phProv, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1u</span>, <span class="hljs-number">0xF0000000</span>) )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> ( CryptCreateHash(phProv, <span class="hljs-number">0x8003</span>u, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, &amp;phHash) )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( CryptHashData(phHash, pbData, dwDataLen, <span class="hljs-number">0</span>) )<br>    &#123;<br>      CryptGetHashParam(phHash, <span class="hljs-number">2u</span>, v6, &amp;pdwDataLen, <span class="hljs-number">0</span>);<br>      *lpString1 = <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; pdwDataLen; ++i )<br>      &#123;<br>        wsprintfA(String2, <span class="hljs-string">&quot;%02X&quot;</span>, v6[i]);<br>        lstrcatA(lpString1, String2);<br>      &#125;<br>      CryptDestroyHash(phHash);<br>      CryptReleaseContext(phProv, <span class="hljs-number">0</span>);<br>      result = <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      CryptDestroyHash(phHash);<br>      CryptReleaseContext(phProv, <span class="hljs-number">0</span>);<br>      result = <span class="hljs-number">0</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    CryptReleaseContext(phProv, <span class="hljs-number">0</span>);<br>    result = <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>0x8003u</code>MD5加密，六位全字符…..，爆破是不可能了，试试撞库</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211123213811388.png" alt="image-20211123213811388"></p>
<p>…..没话讲，somd5牛逼</p>
<p>我们把密码输进去</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211123214222644.png" alt="image-20211123214222644"></p>
<p>根据后面的分析，知道了会生成一个rtf文件，我们打开它</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211123214411755.png" alt="image-20211123214411755"></p>
<p>flag：Flag{N0_M0re_Free_Bugs}</p>
<p>这种做法其实有点取巧了，其实撞不出来也没关系的，直接去看后面的if，也能得到密码</p>
<p>我们去看看判断成功后的<code>if</code>语句对应的函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">char</span> __cdecl <span class="hljs-title function_">sub_4014D0</span><span class="hljs-params">(LPCSTR lpString)</span><br>&#123;<br>  LPCVOID lpBuffer; <span class="hljs-comment">// [esp+50h] [ebp-1Ch]</span><br>  DWORD NumberOfBytesWritten; <span class="hljs-comment">// [esp+58h] [ebp-14h] BYREF</span><br>  DWORD nNumberOfBytesToWrite; <span class="hljs-comment">// [esp+5Ch] [ebp-10h]</span><br>  HGLOBAL hResData; <span class="hljs-comment">// [esp+60h] [ebp-Ch]</span><br>  HRSRC hResInfo; <span class="hljs-comment">// [esp+64h] [ebp-8h]</span><br>  HANDLE hFile; <span class="hljs-comment">// [esp+68h] [ebp-4h]</span><br><br>  hFile = <span class="hljs-number">0</span>;<br>  hResData = <span class="hljs-number">0</span>;<br>  nNumberOfBytesToWrite = <span class="hljs-number">0</span>;<br>  NumberOfBytesWritten = <span class="hljs-number">0</span>;<br>  hResInfo = FindResourceA(<span class="hljs-number">0</span>, (LPCSTR)<span class="hljs-number">0x65</span>, <span class="hljs-string">&quot;AAA&quot;</span>);<br>  <span class="hljs-keyword">if</span> ( !hResInfo )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  nNumberOfBytesToWrite = SizeofResource(<span class="hljs-number">0</span>, hResInfo);<br>  hResData = LoadResource(<span class="hljs-number">0</span>, hResInfo);<br>  <span class="hljs-keyword">if</span> ( !hResData )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  lpBuffer = LockResource(hResData);<br>  sub_401005(lpString, (<span class="hljs-type">int</span>)lpBuffer, nNumberOfBytesToWrite);<br>  hFile = CreateFileA(<span class="hljs-string">&quot;dbapp.rtf&quot;</span>, <span class="hljs-number">0x10000000</span>u, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2u</span>, <span class="hljs-number">0x80</span>u, <span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">if</span> ( hFile == (HANDLE)<span class="hljs-number">-1</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> ( !WriteFile(hFile, lpBuffer, nNumberOfBytesToWrite, &amp;NumberOfBytesWritten, <span class="hljs-number">0</span>) )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  CloseHandle(hFile);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>函数看不懂，没关系，百度百科</p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-findresourcea">FindResourceA函数</a>看这个，大概就是说，将AAA中的数据，以返回值的形式返回给函数</p>
<p>看第22行，将我们传进来的参数（（就是第二个密码+<code>123321@DBApp</code>）一起md5加密后的结果），和<code>FindResourceA</code>函数的返回值，一起传入<code>sub_401005</code>函数</p>
<p><code>sub_401005</code>函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_401420</span><span class="hljs-params">(LPCSTR lpString, <span class="hljs-type">int</span> a2, <span class="hljs-type">int</span> a3)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+4Ch] [ebp-Ch]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v5; <span class="hljs-comment">// [esp+54h] [ebp-4h]</span><br><br>  v5 = lstrlenA(lpString);  <span class="hljs-comment">//a2是FindResourceA的返回值，设他是FA，lpString是第二个密码+123321@DBApp</span><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; ; ++i )<br>  &#123;<br>    result = i;<br>    <span class="hljs-keyword">if</span> ( i &gt;= a3 )<br>      <span class="hljs-keyword">break</span>;<br>    *(_BYTE *)(i + a2) ^= lpString[i % v5]; <span class="hljs-comment">//FA[i] ^= lpString[i % v5]</span><br>  &#125;	  <span class="hljs-comment">//实际就是FA[i]和lpString循环异或，如果lpString越界就从头开始，和RC4生成S盒的操作差不多</span><br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这个异或的作用就是，将我们的<code>第二次输入的密码+123321@DBApp</code>，与AAA中取出来的值进行异或后，创建了一个rtf的文件</p>
<p>那么我们要知道从AAA中取出来的值是什么，这里要用到<code>ResourceHacker</code></p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211123220410825.png" alt="image-20211123220410825"></p>
<p>我们要的，就是lpString的前六位，那么只要我们知道rtf文件的前六位，再和AAA中取出来的前六位异或，就是我们的第二个密码了</p>
<p>我们随意创建一个rtf文件，并随便写点什么来初始化</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211123221611205.png" alt="image-20211123221611205"></p>
<p>我们可以看到，前六位，刚好是rtf文件的头部</p>
<p>写脚本解密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">s = <span class="hljs-string">&quot;&#123;\\rtf1&quot;</span><br><br>a = [<span class="hljs-number">0x05</span>,<span class="hljs-number">0x7D</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x15</span>,<span class="hljs-number">0x26</span>,<span class="hljs-number">0x01</span>]<br><br>flag = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(s)):<br>	x = <span class="hljs-built_in">ord</span>(s[i]) ^ a[i]<br>	flag += <span class="hljs-built_in">chr</span>(x)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure>

<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211123221753291.png" alt="image-20211123221753291"></p>
<p>第二位密码就出来了，之后的就输入密码，看生成的rtf文件，就可以了，不再赘述</p>
<h2 id="2019红帽杯-easyRE"><a href="#2019红帽杯-easyRE" class="headerlink" title="[2019红帽杯]easyRE"></a>[2019红帽杯]easyRE</h2><p>ida反编译，定位字符串到关键代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 <span class="hljs-title function_">sub_4009C6</span><span class="hljs-params">()</span><br>&#123;<br>  __int64 result; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+Ch] [rbp-114h]</span><br>  __int64 v2; <span class="hljs-comment">// [rsp+10h] [rbp-110h]</span><br>  __int64 v3; <span class="hljs-comment">// [rsp+18h] [rbp-108h]</span><br>  __int64 v4; <span class="hljs-comment">// [rsp+20h] [rbp-100h]</span><br>  __int64 v5; <span class="hljs-comment">// [rsp+28h] [rbp-F8h]</span><br>  __int64 v6; <span class="hljs-comment">// [rsp+30h] [rbp-F0h]</span><br>  __int64 v7; <span class="hljs-comment">// [rsp+38h] [rbp-E8h]</span><br>  __int64 v8; <span class="hljs-comment">// [rsp+40h] [rbp-E0h]</span><br>  __int64 v9; <span class="hljs-comment">// [rsp+48h] [rbp-D8h]</span><br>  __int64 v10; <span class="hljs-comment">// [rsp+50h] [rbp-D0h]</span><br>  __int64 v11; <span class="hljs-comment">// [rsp+58h] [rbp-C8h]</span><br>  <span class="hljs-type">char</span> v12[<span class="hljs-number">13</span>]; <span class="hljs-comment">// [rsp+60h] [rbp-C0h] BYREF</span><br>  <span class="hljs-type">char</span> v13[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [rsp+6Dh] [rbp-B3h] BYREF</span><br>  <span class="hljs-type">char</span> v14[<span class="hljs-number">19</span>]; <span class="hljs-comment">// [rsp+71h] [rbp-AFh] BYREF</span><br>  <span class="hljs-type">char</span> v15[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+90h] [rbp-90h] BYREF</span><br>  <span class="hljs-type">int</span> v16; <span class="hljs-comment">// [rsp+B0h] [rbp-70h]</span><br>  <span class="hljs-type">char</span> v17; <span class="hljs-comment">// [rsp+B4h] [rbp-6Ch]</span><br>  <span class="hljs-type">char</span> v18[<span class="hljs-number">72</span>]; <span class="hljs-comment">// [rsp+C0h] [rbp-60h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 v19; <span class="hljs-comment">// [rsp+108h] [rbp-18h]</span><br><br>  v19 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  qmemcpy(v12, <span class="hljs-string">&quot;Iodl&gt;Qnb(ocy&quot;</span>, <span class="hljs-number">12</span>);<br>  v12[<span class="hljs-number">12</span>] = <span class="hljs-number">127</span>;<br>  qmemcpy(v13, <span class="hljs-string">&quot;y.i&quot;</span>, <span class="hljs-number">3</span>);<br>  v13[<span class="hljs-number">3</span>] = <span class="hljs-number">127</span>;<br>  qmemcpy(v14, <span class="hljs-string">&quot;d`3w&#125;wek9&#123;iy=~yL@EC&quot;</span>, <span class="hljs-keyword">sizeof</span>(v14));<br>  <span class="hljs-built_in">memset</span>(v15, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(v15)); <span class="hljs-comment">//memset的v15是输入</span><br>  v16 = <span class="hljs-number">0</span>;<br>  v17 = <span class="hljs-number">0</span>;<br>  sub_4406E0(<span class="hljs-number">0LL</span>, v15, <span class="hljs-number">37LL</span>);<br>  v17 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> ( sub_424BA0(v15) == <span class="hljs-string">&#x27;$&#x27;</span> )<br>  &#123;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; (<span class="hljs-type">unsigned</span> __int64)sub_424BA0(v15); ++i )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> __int8)(v15[i] ^ i) != v12[i] )<br>      &#123;<br>        result = <span class="hljs-number">4294967294LL</span>;<br>        <span class="hljs-keyword">goto</span> LABEL_13;<br>      &#125;<br>    &#125;<br>    sub_410CC0(<span class="hljs-string">&quot;continue!&quot;</span>);<br>    <span class="hljs-built_in">memset</span>(v18, <span class="hljs-number">0</span>, <span class="hljs-number">0x40</span>uLL);<br>    v18[<span class="hljs-number">64</span>] = <span class="hljs-number">0</span>;<br>    sub_4406E0(<span class="hljs-number">0LL</span>, v18, <span class="hljs-number">64LL</span>);<br>    v18[<span class="hljs-number">39</span>] = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> ( sub_424BA0(v18) == <span class="hljs-number">39</span> )<br>    &#123;<br>      v2 = sub_400E44(v18);                     <span class="hljs-comment">// base64</span><br>      v3 = sub_400E44(v2);<br>      v4 = sub_400E44(v3);<br>      v5 = sub_400E44(v4);<br>      v6 = sub_400E44(v5);<br>      v7 = sub_400E44(v6);<br>      v8 = sub_400E44(v7);<br>      v9 = sub_400E44(v8);<br>      v10 = sub_400E44(v9);<br>      v11 = sub_400E44(v10);<br>      <span class="hljs-keyword">if</span> ( !(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)sub_400360(v11, off_6CC090) )<br>      &#123;<br>        sub_410CC0(<span class="hljs-string">&quot;You found me!!!&quot;</span>);<br>        sub_410CC0(<span class="hljs-string">&quot;bye bye~&quot;</span>);<br>      &#125;<br>      result = <span class="hljs-number">0LL</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      result = <span class="hljs-number">4294967293LL</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    result = <span class="hljs-number">0xFFFFFFFF</span>LL;<br>  &#125;<br>LABEL_13:<br>  <span class="hljs-keyword">if</span> ( __readfsqword(<span class="hljs-number">0x28</span>u) != v19 )<br>    sub_444020();<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>第37行的for循环对我们输入的v15异或后与v12进行了比较，写脚本解密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">code = <span class="hljs-string">&#x27;Iodl&gt;Qnb(ocy\x7Fy.i\x7Fd`3w&#125;wek9&#123;iy=~yL@EC&#x27;</span><br>flag = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-comment">#print(list_code)</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(code)):<br>    flag += <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(code[i])^i)<br><span class="hljs-built_in">print</span>(flag)<br><span class="hljs-comment">#Info:The first four chars are `flag`</span><br></code></pre></td></tr></table></figure>

<p>要注意一下v12 v13 v14都是v12的值，ida反汇编引擎不是万能的，这里他就把一整串的数据，由于<code>\x7F</code>这个正则表达式的干扰，错误的分析成了三个串</p>
<p>输出结果提醒我们，flag的前四位是flag（听君一席话，如听一席话）</p>
<p><code>off_6CC090</code></p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211230153247674.png" alt="image-20211230153247674"></p>
<p>将数据十次base64解密后，是一个网站</p>
<p><a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-254172.htm">https://bbs.pediy.com/thread-254172.htm</a></p>
<p>是看雪的讲主动防御的一篇帖子，一看就知道被坑了</p>
<p>打开ida的Segments窗口，能看到fini段有这样一段函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 <span class="hljs-title function_">sub_400D35</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> __int64 result; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v1; <span class="hljs-comment">// [rsp+Ch] [rbp-24h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+10h] [rbp-20h]</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+14h] [rbp-1Ch]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v4; <span class="hljs-comment">// [rsp+24h] [rbp-Ch]</span><br>  <span class="hljs-type">unsigned</span> __int64 v5; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br><br>  v5 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  v1 = sub_43FD20(<span class="hljs-number">0LL</span>) - qword_6CEE38;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">1233</span>; ++i )<br>  &#123;<br>    sub_40F790(v1);<br>    sub_40FE60();<br>    sub_40FE60();<br>    v1 = sub_40FE60() ^ <span class="hljs-number">2557891634</span>;<br>  &#125;<br>  v4 = v1;<br>  <span class="hljs-keyword">if</span> ( ((<span class="hljs-type">unsigned</span> __int8)v1 ^ byte_6CC0A0[<span class="hljs-number">0</span>]) == <span class="hljs-string">&#x27;f&#x27;</span> &amp;&amp; (HIBYTE(v4) ^ (<span class="hljs-type">unsigned</span> __int8)byte_6CC0A3) == <span class="hljs-string">&#x27;g&#x27;</span> )<br>  &#123;<br>    <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">24</span>; ++j )<br>      sub_410E90((<span class="hljs-type">unsigned</span> __int8)(byte_6CC0A0[j] ^ *((_BYTE *)&amp;v4 + j % <span class="hljs-number">4</span>))); <span class="hljs-comment">//v4的前四位和byte_6CC0A0[j]循环异或</span><br>  &#125;<br>  result = __readfsqword(<span class="hljs-number">0x28</span>u) ^ v5;<br>  <span class="hljs-keyword">if</span> ( result )<br>    sub_444020();<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>根据if判断就能看出来这里才是加密</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20220101181043422.png" alt="image-20220101181043422"></p>
<p>能看到<code>byte_6CC0A0</code>和<code>byte_6CC0A3</code>的内存是连续的，可以通过A0下标的方式访问A3的数据</p>
<p>那就不难看出来，v4的前四位异或结果是<code>flag</code></p>
<p>脚本解密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">code1 = [<span class="hljs-number">0x40</span>,<span class="hljs-number">0x35</span>,<span class="hljs-number">0x20</span>,<span class="hljs-number">0x56</span>]<br>code2 = [<span class="hljs-string">&quot;f&quot;</span>,<span class="hljs-string">&quot;l&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;g&quot;</span>]<br>code = [<span class="hljs-number">0</span>]*<span class="hljs-number">4</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>    code[i] = code1[i]^<span class="hljs-built_in">ord</span>(code2[i])<br><span class="hljs-comment">#print(code)</span><br>code3 = [ <span class="hljs-number">0x40</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x2F</span>,<br>  <span class="hljs-number">0x24</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x6E</span>,<br>  <span class="hljs-number">0x72</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x5B</span>]<br>flag = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(code3)):<br>    flag += <span class="hljs-built_in">chr</span>(code3[i] ^ code[i%<span class="hljs-number">4</span>])<br><span class="hljs-built_in">print</span>(flag)<br><span class="hljs-comment">#flag&#123;Aet1vc_De`en5c_Teut&#125;</span><br></code></pre></td></tr></table></figure>

<h2 id="FlareOn4-login"><a href="#FlareOn4-login" class="headerlink" title="[FlareOn4]login"></a>[FlareOn4]login</h2><p>给了个html，F12看页面源码  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">Html</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>FLARE On 2017<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;flag&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;flag&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Enter the flag&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;prompt&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Click to check the flag&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;prompt&quot;</span>).<span class="hljs-property">onclick</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">                <span class="hljs-keyword">var</span> flag = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;flag&quot;</span>).<span class="hljs-property">value</span>;</span><br><span class="language-javascript">                <span class="hljs-keyword">var</span> rotFlag = flag.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[a-zA-Z]/g</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">c</span>)&#123;<span class="hljs-keyword">return</span> <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>((c &lt;= <span class="hljs-string">&quot;Z&quot;</span> ? <span class="hljs-number">90</span> : <span class="hljs-number">122</span>) &gt;= (c = c.<span class="hljs-title function_">charCodeAt</span>(<span class="hljs-number">0</span>) + <span class="hljs-number">13</span>) ? c : c - <span class="hljs-number">26</span>);&#125;);</span><br><span class="language-javascript">                <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;PyvragFvqrYbtvafNerRnfl@syner-ba.pbz&quot;</span> == rotFlag) &#123;</span><br><span class="language-javascript">                    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;Correct flag!&quot;</span>);</span><br><span class="language-javascript">                &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="language-javascript">                    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;Incorrect flag, rot again&quot;</span>);</span><br><span class="language-javascript">                &#125;</span><br><span class="language-javascript">            &#125;</span><br><span class="language-javascript">        </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure>

<p>关键在于第12行的replace函数，整体是一个大的？：三目运算符</p>
<p>逻辑为，对<code>(c &lt;= &quot;Z&quot; ? 90 : 122) &gt;= (c = c.charCodeAt(0) + 13)</code>这个表达式进行判断，如果为真则值不变，如果为假则对应ascii-26，最后与<code>PyvragFvqrYbtvafNerRnfl@syner-ba.pbz</code>串进行比较</p>
<p>分开成三部分进行分析：<br>1：<code>设res1 = c &lt;= &quot;Z&quot; ? 90 : 122</code><br>每次传入一个字母，看看是大写还是小写，并且对应z的ascii码。<br>2：<code>设res2 = c.charCodeAt(0) + 13</code><br>将当前字符的ascii值加13<br>3: <code>res1 &gt;= res2 ? res2 : res2 - 26</code><br>最后看看加完的值是不是大于当前的Z，如果是的话就减26，否则输出+13后的结果，也就是res2<br>转换成ifelse结构后就是这样</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">int</span> x;<br>    scanf_s(<span class="hljs-string">&quot;%d&quot;</span>, &amp;x);<br>    <span class="hljs-keyword">if</span> (x &gt;=  <span class="hljs-string">&#x27;a&#x27;</span> &amp;&amp; x &lt;= <span class="hljs-string">&#x27;z&#x27;</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (x + <span class="hljs-number">13</span> &gt; <span class="hljs-string">&#x27;z&#x27;</span>)<br>        &#123;<br>            x = x + <span class="hljs-number">13</span> - <span class="hljs-number">26</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            x = x + <span class="hljs-number">13</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-keyword">if</span> (x &gt;= <span class="hljs-string">&#x27;A&#x27;</span> &amp;&amp; x &lt;= <span class="hljs-string">&#x27;Z&#x27;</span>)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (x + <span class="hljs-number">13</span> &gt; <span class="hljs-string">&#x27;Z&#x27;</span>)<br>            &#123;<br>                x = x + <span class="hljs-number">13</span> - <span class="hljs-number">26</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                x = x + <span class="hljs-number">13</span>;<br>            &#125;<br>        &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d&quot;</span>, x);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>不难分析出，整体就是将字母表的左半区+13，右半区-13，所以我们只需要把结果字符串的字母表的左半区+13，右半区-13，也就是相应位置对调，就可以解出flag</p>
<p>附上exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python">code = <span class="hljs-string">&quot;PyvragFvqrYbtvafNerRnfl@syner-ba.pbz&quot;</span><br>flag = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(code)):<br>    x = code[i]<br>    <span class="hljs-keyword">if</span> code[i] &gt;=<span class="hljs-string">&#x27;a&#x27;</span> <span class="hljs-keyword">and</span> code[i] &lt;=<span class="hljs-string">&#x27;z&#x27;</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">ord</span>(code[i]) - <span class="hljs-number">13</span> &lt; <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;a&#x27;</span>):<br>            x = <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(code[i]) + <span class="hljs-number">13</span>)<br>        <span class="hljs-keyword">else</span>:<br>            x = <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(code[i]) - <span class="hljs-number">13</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">if</span> code[i] &gt;=<span class="hljs-string">&#x27;A&#x27;</span> <span class="hljs-keyword">and</span> code[i] &lt;=<span class="hljs-string">&#x27;Z&#x27;</span>:<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">ord</span>(code[i]) - <span class="hljs-number">13</span> &lt; <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>):<br>                x = <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(code[i])+<span class="hljs-number">13</span>)<br>            <span class="hljs-keyword">else</span>:<br>                x = <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(code[i]) - <span class="hljs-number">13</span>)<br>    flag += x<br><span class="hljs-built_in">print</span>(flag)<br><span class="hljs-comment">#flag&#123;ClientSideLoginsAreEasy@flare-on.com&#125;</span><br></code></pre></td></tr></table></figure>

<h2 id="GUET-CTF2019-re"><a href="#GUET-CTF2019-re" class="headerlink" title="[GUET-CTF2019]re"></a>[GUET-CTF2019]re</h2><p>upx脱壳</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20220104164020301.png" alt="image-20220104164020301"></p>
<p>定位字符串到关键代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs c">_BOOL8 __fastcall <span class="hljs-title function_">sub_4009AE</span><span class="hljs-params">(<span class="hljs-type">char</span> *a1)</span><br>&#123;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">1629056</span> * *a1 != <span class="hljs-number">166163712</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">6771600</span> * a1[<span class="hljs-number">1</span>] != <span class="hljs-number">731332800</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">3682944</span> * a1[<span class="hljs-number">2</span>] != <span class="hljs-number">357245568</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">10431000</span> * a1[<span class="hljs-number">3</span>] != <span class="hljs-number">1074393000</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">3977328</span> * a1[<span class="hljs-number">4</span>] != <span class="hljs-number">489211344</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">5138336</span> * a1[<span class="hljs-number">5</span>] != <span class="hljs-number">518971936</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">7532250</span> * a1[<span class="hljs-number">7</span>] != <span class="hljs-number">406741500</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">5551632</span> * a1[<span class="hljs-number">8</span>] != <span class="hljs-number">294236496</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">3409728</span> * a1[<span class="hljs-number">9</span>] != <span class="hljs-number">177305856</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">13013670</span> * a1[<span class="hljs-number">10</span>] != <span class="hljs-number">650683500</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">6088797</span> * a1[<span class="hljs-number">11</span>] != <span class="hljs-number">298351053</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">7884663</span> * a1[<span class="hljs-number">12</span>] != <span class="hljs-number">386348487</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">8944053</span> * a1[<span class="hljs-number">13</span>] != <span class="hljs-number">438258597</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">5198490</span> * a1[<span class="hljs-number">14</span>] != <span class="hljs-number">249527520</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">4544518</span> * a1[<span class="hljs-number">15</span>] != <span class="hljs-number">445362764</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">3645600</span> * a1[<span class="hljs-number">17</span>] != <span class="hljs-number">174988800</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">10115280</span> * a1[<span class="hljs-number">16</span>] != <span class="hljs-number">981182160</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">9667504</span> * a1[<span class="hljs-number">18</span>] != <span class="hljs-number">493042704</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">5364450</span> * a1[<span class="hljs-number">19</span>] != <span class="hljs-number">257493600</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">13464540</span> * a1[<span class="hljs-number">20</span>] != <span class="hljs-number">767478780</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">5488432</span> * a1[<span class="hljs-number">21</span>] != <span class="hljs-number">312840624</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">14479500</span> * a1[<span class="hljs-number">22</span>] != <span class="hljs-number">1404511500</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">6451830</span> * a1[<span class="hljs-number">23</span>] != <span class="hljs-number">316139670</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">6252576</span> * a1[<span class="hljs-number">24</span>] != <span class="hljs-number">619005024</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">7763364</span> * a1[<span class="hljs-number">25</span>] != <span class="hljs-number">372641472</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">7327320</span> * a1[<span class="hljs-number">26</span>] != <span class="hljs-number">373693320</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">8741520</span> * a1[<span class="hljs-number">27</span>] != <span class="hljs-number">498266640</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">8871876</span> * a1[<span class="hljs-number">28</span>] != <span class="hljs-number">452465676</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">4086720</span> * a1[<span class="hljs-number">29</span>] != <span class="hljs-number">208422720</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-number">9374400</span> * a1[<span class="hljs-number">30</span>] == <span class="hljs-number">515592000</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">5759124</span> * a1[<span class="hljs-number">31</span>] == <span class="hljs-number">719890500</span>;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>可以使用z3求解器进行求解</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br>s = Solver()<br>a1 = [<span class="hljs-number">0</span>]*<span class="hljs-number">32</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>    a1[i] = Int(<span class="hljs-string">&#x27;a1[&#x27;</span>+<span class="hljs-built_in">str</span>(i)+<span class="hljs-string">&#x27;]&#x27;</span>)<br><br>s.add( <span class="hljs-number">1629056</span> * a1[<span class="hljs-number">0</span>] == <span class="hljs-number">166163712</span> )<br>s.add( <span class="hljs-number">6771600</span> * a1[<span class="hljs-number">1</span>] == <span class="hljs-number">731332800</span> )<br>s.add( <span class="hljs-number">3682944</span> * a1[<span class="hljs-number">2</span>] == <span class="hljs-number">357245568</span> )<br>s.add( <span class="hljs-number">10431000</span> * a1[<span class="hljs-number">3</span>] == <span class="hljs-number">1074393000</span> )<br>s.add( <span class="hljs-number">3977328</span> * a1[<span class="hljs-number">4</span>] == <span class="hljs-number">489211344</span> )<br>s.add( <span class="hljs-number">5138336</span> * a1[<span class="hljs-number">5</span>] == <span class="hljs-number">518971936</span> )<br>s.add( <span class="hljs-number">7532250</span> * a1[<span class="hljs-number">7</span>] == <span class="hljs-number">406741500</span> )<br>s.add( <span class="hljs-number">5551632</span> * a1[<span class="hljs-number">8</span>] == <span class="hljs-number">294236496</span> )<br>s.add( <span class="hljs-number">3409728</span> * a1[<span class="hljs-number">9</span>] == <span class="hljs-number">177305856</span> )<br>s.add( <span class="hljs-number">13013670</span> * a1[<span class="hljs-number">10</span>] == <span class="hljs-number">650683500</span> )<br>s.add( <span class="hljs-number">6088797</span> * a1[<span class="hljs-number">11</span>] == <span class="hljs-number">298351053</span> )<br>s.add( <span class="hljs-number">7884663</span> * a1[<span class="hljs-number">12</span>] == <span class="hljs-number">386348487</span> )<br>s.add( <span class="hljs-number">8944053</span> * a1[<span class="hljs-number">13</span>] == <span class="hljs-number">438258597</span> )<br>s.add( <span class="hljs-number">5198490</span> * a1[<span class="hljs-number">14</span>] == <span class="hljs-number">249527520</span> )<br>s.add( <span class="hljs-number">4544518</span> * a1[<span class="hljs-number">15</span>] == <span class="hljs-number">445362764</span> )<br>s.add( <span class="hljs-number">3645600</span> * a1[<span class="hljs-number">17</span>] == <span class="hljs-number">174988800</span> )<br>s.add( <span class="hljs-number">10115280</span> * a1[<span class="hljs-number">16</span>] == <span class="hljs-number">981182160</span> )<br>s.add( <span class="hljs-number">9667504</span> * a1[<span class="hljs-number">18</span>] == <span class="hljs-number">493042704</span> )<br>s.add( <span class="hljs-number">5364450</span> * a1[<span class="hljs-number">19</span>] == <span class="hljs-number">257493600</span> )<br>s.add( <span class="hljs-number">13464540</span> * a1[<span class="hljs-number">20</span>] == <span class="hljs-number">767478780</span> )<br>s.add( <span class="hljs-number">5488432</span> * a1[<span class="hljs-number">21</span>] == <span class="hljs-number">312840624</span> )<br>s.add( <span class="hljs-number">14479500</span> * a1[<span class="hljs-number">22</span>] == <span class="hljs-number">1404511500</span> )<br>s.add( <span class="hljs-number">6451830</span> * a1[<span class="hljs-number">23</span>] == <span class="hljs-number">316139670</span> )<br>s.add( <span class="hljs-number">6252576</span> * a1[<span class="hljs-number">24</span>] == <span class="hljs-number">619005024</span> )<br>s.add( <span class="hljs-number">7763364</span> * a1[<span class="hljs-number">25</span>] == <span class="hljs-number">372641472</span> )<br>s.add( <span class="hljs-number">7327320</span> * a1[<span class="hljs-number">26</span>] == <span class="hljs-number">373693320</span> )<br>s.add( <span class="hljs-number">8741520</span> * a1[<span class="hljs-number">27</span>] == <span class="hljs-number">498266640</span> )<br>s.add( <span class="hljs-number">8871876</span> * a1[<span class="hljs-number">28</span>] == <span class="hljs-number">452465676</span> )<br>s.add( <span class="hljs-number">4086720</span> * a1[<span class="hljs-number">29</span>] == <span class="hljs-number">208422720</span> )<br>s.add( <span class="hljs-number">9374400</span> * a1[<span class="hljs-number">30</span>] == <span class="hljs-number">515592000</span> )<br>s.add(<span class="hljs-number">5759124</span> * a1[<span class="hljs-number">31</span>] == <span class="hljs-number">719890500</span>)<br>s.check()<br><span class="hljs-built_in">print</span>(s.model())<br></code></pre></td></tr></table></figure>

<p>根据结果写出解密脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python">a1 = [<span class="hljs-number">0</span>]*<span class="hljs-number">32</span><br>a1[<span class="hljs-number">31</span>] = <span class="hljs-number">125</span><br>a1[<span class="hljs-number">30</span>] = <span class="hljs-number">55</span><br>a1[<span class="hljs-number">29</span>] = <span class="hljs-number">51</span><br>a1[<span class="hljs-number">28</span>] = <span class="hljs-number">51</span><br>a1[<span class="hljs-number">27</span>] = <span class="hljs-number">57</span><br>a1[<span class="hljs-number">26</span>] = <span class="hljs-number">51</span><br>a1[<span class="hljs-number">25</span>] = <span class="hljs-number">48</span><br>a1[<span class="hljs-number">24</span>] = <span class="hljs-number">99</span><br>a1[<span class="hljs-number">23</span>] = <span class="hljs-number">49</span><br>a1[<span class="hljs-number">22</span>] = <span class="hljs-number">97</span><br>a1[<span class="hljs-number">21</span>] = <span class="hljs-number">57</span><br>a1[<span class="hljs-number">20</span>] = <span class="hljs-number">57</span><br>a1[<span class="hljs-number">19</span>] = <span class="hljs-number">48</span><br>a1[<span class="hljs-number">18</span>] = <span class="hljs-number">51</span><br>a1[<span class="hljs-number">16</span>] = <span class="hljs-number">97</span><br>a1[<span class="hljs-number">17</span>] = <span class="hljs-number">48</span><br>a1[<span class="hljs-number">15</span>] = <span class="hljs-number">98</span><br>a1[<span class="hljs-number">14</span>] = <span class="hljs-number">48</span><br>a1[<span class="hljs-number">13</span>] = <span class="hljs-number">49</span><br>a1[<span class="hljs-number">12</span>] = <span class="hljs-number">49</span><br>a1[<span class="hljs-number">11</span>] = <span class="hljs-number">49</span><br>a1[<span class="hljs-number">10</span>] = <span class="hljs-number">50</span><br>a1[<span class="hljs-number">9</span>] = <span class="hljs-number">52</span><br>a1[<span class="hljs-number">8</span>] = <span class="hljs-number">53</span><br>a1[<span class="hljs-number">7</span>] = <span class="hljs-number">54</span><br>a1[<span class="hljs-number">5</span>] = <span class="hljs-number">101</span><br>a1[<span class="hljs-number">4</span>] = <span class="hljs-number">123</span><br>a1[<span class="hljs-number">3</span>] = <span class="hljs-number">103</span><br>a1[<span class="hljs-number">2</span>] = <span class="hljs-number">97</span><br>a1[<span class="hljs-number">1</span>] = <span class="hljs-number">108</span><br>a1[<span class="hljs-number">0</span>] = <span class="hljs-number">102</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>    <span class="hljs-keyword">if</span> i == <span class="hljs-number">6</span>:<br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(a1[i]),end=<span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-comment">#flag&#123;e65421110ba03099a1c039337&#125;</span><br></code></pre></td></tr></table></figure>

<p>a[7]没有给，题目问题，直接试就行</p>
<h2 id="SUCTF2019-SignIn"><a href="#SUCTF2019-SignIn" class="headerlink" title="[SUCTF2019]SignIn"></a>[SUCTF2019]SignIn</h2><p>ida定位关键代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">char</span> **a2, <span class="hljs-type">char</span> **a3)</span><br>&#123;<br>  <span class="hljs-type">char</span> v4[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-4A0h] BYREF</span><br>  <span class="hljs-type">char</span> v5[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+10h] [rbp-490h] BYREF</span><br>  <span class="hljs-type">char</span> v6[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-480h] BYREF</span><br>  <span class="hljs-type">char</span> v7[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [rsp+30h] [rbp-470h] BYREF</span><br>  <span class="hljs-type">char</span> v8[<span class="hljs-number">112</span>]; <span class="hljs-comment">// [rsp+40h] [rbp-460h] BYREF</span><br>  <span class="hljs-type">char</span> v9[<span class="hljs-number">1000</span>]; <span class="hljs-comment">// [rsp+B0h] [rbp-3F0h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 v10; <span class="hljs-comment">// [rsp+498h] [rbp-8h]</span><br><br>  v10 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[sign in]&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[input your flag]: &quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%99s&quot;</span>, v8);<br>  sub_96A(v8, v9);<br>  __gmpz_init_set_str(v7, <span class="hljs-string">&quot;ad939ff59f6e70bcbfad406f2494993757eee98b91bc244184a377520d06fc35&quot;</span>, <span class="hljs-number">16LL</span>);<br>  __gmpz_init_set_str(v6, v9, <span class="hljs-number">16LL</span>);<br>  __gmpz_init_set_str(v4, <span class="hljs-string">&quot;103461035900816914121390101299049044413950405173712170434161686539878160984549&quot;</span>, <span class="hljs-number">10LL</span>);<br>  __gmpz_init_set_str(v5, <span class="hljs-string">&quot;65537&quot;</span>, <span class="hljs-number">10LL</span>);<br>  __gmpz_powm(v6, v6, v5, v4);<br>  <span class="hljs-keyword">if</span> ( (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)__gmpz_cmp(v6, v7) )<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;GG!&quot;</span>);<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;TTTTTTTTTTql!&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br><span class="hljs-type">size_t</span> __fastcall <span class="hljs-title function_">sub_96A</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *a1, __int64 a2)</span><br>&#123;<br>  <span class="hljs-type">size_t</span> result; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// [rsp+18h] [rbp-18h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+1Ch] [rbp-14h]</span><br><br>  v3 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; ; i += <span class="hljs-number">2</span> )<br>  &#123;<br>    result = <span class="hljs-built_in">strlen</span>(a1);<br>    <span class="hljs-keyword">if</span> ( v3 &gt;= result )<br>      <span class="hljs-keyword">break</span>;<br>    *(_BYTE *)(a2 + i) = byte_202010[a1[v3] &gt;&gt; <span class="hljs-number">4</span>];  <span class="hljs-comment">//a1是输入的字符串序列</span><br>    *(_BYTE *)(a2 + i + <span class="hljs-number">1LL</span>) = byte_202010[a1[v3++] &amp; <span class="hljs-number">0xF</span>];<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>RSA加密</p>
<p><a href="%5Bfactordb.com%5D(http://www.factordb.com/)">网站</a>分解大数，写出脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br>N = <span class="hljs-number">103461035900816914121390101299049044413950405173712170434161686539878160984549</span><br>E = <span class="hljs-number">65537</span><br>p = <span class="hljs-number">282164587459512124844245113950593348271</span><br>q = <span class="hljs-number">366669102002966856876605669837014229419</span><br>L = (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>D = <span class="hljs-built_in">int</span>(gmpy2.invert(E, L))<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">gmpy2.invert()返回值类型为&lt;class &#x27;mpz&#x27;&gt;</span><br><span class="hljs-string">invert(x,y)  计算 x 关于1模 y 的乘法逆元</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>enstr = <span class="hljs-number">0xad939ff59f6e70bcbfad406f2494993757eee98b91bc244184a377520d06fc35</span><br>destr = gmpy2.powmod(enstr, D, N)<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">gmpy2.powmod()返回值类型为&lt;class &#x27;mpz&#x27;&gt;</span><br><span class="hljs-string">gmpy2.powmod(x,y,z)，计算x^y mod z 的值并返回</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>flag0 = <span class="hljs-built_in">hex</span>(destr)[<span class="hljs-number">2</span>:]     <span class="hljs-comment"># flag0类型为str，存的是十六进制表示的字符串</span><br>flag1 = <span class="hljs-built_in">bytes</span>.fromhex(flag0)  <span class="hljs-comment"># 将其从十六进制转换为byte类型(此时已解释成字符)</span><br>flag = <span class="hljs-built_in">str</span>(flag1, <span class="hljs-string">&#x27;utf-8&#x27;</span>)  <span class="hljs-comment"># 将byte类型转换为str类型</span><br><span class="hljs-built_in">print</span>(flag)<br><span class="hljs-comment">#suctf&#123;Pwn_@_hundred_years&#125;</span><br></code></pre></td></tr></table></figure>

<h2 id="WUSTCTF2020-level1"><a href="#WUSTCTF2020-level1" class="headerlink" title="[WUSTCTF2020]level1"></a>[WUSTCTF2020]level1</h2><p>ida反编译</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+4h] [rbp-2Ch]</span><br>  FILE *stream; <span class="hljs-comment">// [rsp+8h] [rbp-28h]</span><br>  <span class="hljs-type">char</span> ptr[<span class="hljs-number">24</span>]; <span class="hljs-comment">// [rsp+10h] [rbp-20h] BYREF</span><br>  <span class="hljs-type">unsigned</span> __int64 v7; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br><br>  v7 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  stream = fopen(<span class="hljs-string">&quot;flag&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>);<br>  fread(ptr, <span class="hljs-number">1uLL</span>, <span class="hljs-number">0x14</span>uLL, stream);<br>  fclose(stream);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">19</span>; ++i )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( (i &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span> )<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%ld\n&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(ptr[i] &lt;&lt; i));<br>    <span class="hljs-keyword">else</span><br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%ld\n&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(i * ptr[i]));<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>读取根目录下的flag文件，并运算输出结果，根据题给output文件，写出脚本（注：output文件少了第一位，随便补个0）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iomanip&gt;</span> </span><br>using namespace <span class="hljs-built_in">std</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> ptr[<span class="hljs-number">20</span>] = &#123; <span class="hljs-number">0</span>,<span class="hljs-number">198</span> ,<span class="hljs-number">232</span>,<span class="hljs-number">816</span>,<span class="hljs-number">200</span>,<span class="hljs-number">1536</span>,<span class="hljs-number">300</span>,<span class="hljs-number">6144</span>,<span class="hljs-number">984</span>,<span class="hljs-number">51200</span>,<span class="hljs-number">570</span>,<span class="hljs-number">92160</span>,<span class="hljs-number">1200</span>,<span class="hljs-number">565248</span>,<span class="hljs-number">756</span>,<span class="hljs-number">1474560</span>,<span class="hljs-number">800</span>,<span class="hljs-number">6291456</span>,<span class="hljs-number">1782</span>,<span class="hljs-number">65536000</span> &#125;;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">19</span>; ++i)<br>    &#123;<br>        <span class="hljs-keyword">if</span> ((i &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span>)<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lc&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(ptr[i] &gt;&gt; i));<br>        <span class="hljs-keyword">else</span><br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lc&quot;</span>, (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(ptr[i] / i));<br>    &#125;<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-comment">//ctf2020&#123;d9-dE6-20c&#125;</span><br></code></pre></td></tr></table></figure>

<h2 id="Transform"><a href="#Transform" class="headerlink" title="Transform"></a>Transform</h2><p>无壳，ida64分析</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-type">char</span> Str[<span class="hljs-number">104</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-70h] BYREF</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+88h] [rbp-8h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+8Ch] [rbp-4h]</span><br><br>  <span class="hljs-built_in">sub_402230</span>(argc, argv, envp);<br>  <span class="hljs-built_in">sub_40E640</span>(<span class="hljs-string">&quot;Give me your code:\n&quot;</span>);<br>  <span class="hljs-built_in">sub_40E5F0</span>(<span class="hljs-string">&quot;%s&quot;</span>, Str);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(Str) != <span class="hljs-number">33</span> )  <span class="hljs-comment">//flag长度32位</span><br>  &#123;<br>    <span class="hljs-built_in">sub_40E640</span>(<span class="hljs-string">&quot;Wrong!\n&quot;</span>);<br>    <span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;pause&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  &#125;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">32</span>; ++i )<br>  &#123;<br>    byte_414040[i] = Str[dword_40F040[i]];   <br>    byte_414040[i] ^= <span class="hljs-built_in">LOBYTE</span>(dword_40F040[i]);  <span class="hljs-comment">//Str[dword_40F040[i]] ^= dword_40F040[i]</span><br>  &#125;<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">32</span>; ++j )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( byte_40F0E0[j] != byte_414040[j] )<br>    &#123;<br>      <span class="hljs-built_in">sub_40E640</span>(<span class="hljs-string">&quot;Wrong!\n&quot;</span>);<br>      <span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;pause&quot;</span>);<br>      <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>    &#125;<br>  &#125;<br>  <span class="hljs-built_in">sub_40E640</span>(<span class="hljs-string">&quot;Right!Good Job!\n&quot;</span>);<br>  <span class="hljs-built_in">sub_40E640</span>(<span class="hljs-string">&quot;Here is your flag: %s\n&quot;</span>, Str);<br>  <span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;pause&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>分析一下逻辑，我们设Str = flag，dword_40F040 = ss，byte_40F0E0 = code，那么逻辑就是，flag[ss[i]] = flag[ss[i]] ^ ss[i]，然后判断 flag[ss[i]] == code[i]，而我们所求的，就是flag</p>
<p>因为异或可逆，所以code[i] ^ ss[i] = flag[ss[i]]，然后按顺序输出flag，即可</p>
<p><strong>注意：这里不能用 flag[i] 来接收 code[i] ^ ss[i] 的值，因为正常的逻辑是，我们将一个flag序列输入到 flag[i] 中，然后按 ss[i] 序列与 ss[i] 异或，那么实际上，此时flag的内部已经是乱序（按ss[i]序列排序）的了，而最后，code是和flag进行顺序比较的，也就是说code里面也是乱序（按ss[i]序列排序），那么如果我们顺序的接收这个异或结果，那必然是错误的。</strong></p>
<p><strong>我们需要让 flag 按 ss[i] 的序列来接收异或结果，那么此时flag列表的内部顺序就是我们输入的顺序，也就是正确的顺序</strong></p>
<p>如果看不懂可以看我下面的输出结果</p>
<p>写脚本跑了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">ss = [<span class="hljs-number">0x9</span>,<span class="hljs-number">0x0A</span>,<span class="hljs-number">0x0F</span>,<span class="hljs-number">0x17</span>,<span class="hljs-number">0x7</span>,<span class="hljs-number">0x18</span>,<span class="hljs-number">0x0C</span>,<span class="hljs-number">0x6</span>,<span class="hljs-number">0x1</span>,<span class="hljs-number">0x10</span>,<span class="hljs-number">0x3</span>,<span class="hljs-number">0x11</span>,<span class="hljs-number">0x20</span>,<br>      <span class="hljs-number">0x1D</span>,<span class="hljs-number">0x0B</span>,<span class="hljs-number">0x1E</span>,<span class="hljs-number">0x1B</span>,<span class="hljs-number">0x16</span>,<span class="hljs-number">0x4</span>,<span class="hljs-number">0x0D</span>,<span class="hljs-number">0x13</span>,<span class="hljs-number">0x14</span>,<span class="hljs-number">0x15</span>,<span class="hljs-number">0x2</span>,<span class="hljs-number">0x19</span>,<br>      <span class="hljs-number">0x5</span>,<span class="hljs-number">0x1F</span>,<span class="hljs-number">0x8</span>,<span class="hljs-number">0x12</span>,<span class="hljs-number">0x1A</span>,<span class="hljs-number">0x1C</span>,<span class="hljs-number">0x0E</span>,<span class="hljs-number">8</span>]<br>code = [<span class="hljs-number">0x67</span>,<span class="hljs-number">0x79</span>,<span class="hljs-number">0x7B</span>,<span class="hljs-number">0x7F</span>,<span class="hljs-number">0x75</span>,<span class="hljs-number">0x2B</span>,<span class="hljs-number">0x3C</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0x53</span>,<span class="hljs-number">0x79</span>,<span class="hljs-number">0x57</span>,<br>        <span class="hljs-number">0x5E</span>,<span class="hljs-number">0x5D</span>,<span class="hljs-number">0x42</span>,<span class="hljs-number">0x7B</span>,<span class="hljs-number">0x2D</span>,<span class="hljs-number">0x2A</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x42</span>,<span class="hljs-number">0x7E</span>,<span class="hljs-number">0x4C</span>,<span class="hljs-number">0x57</span>,<br>        <span class="hljs-number">0x79</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0x6B</span>,<span class="hljs-number">0x7E</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x3C</span>,<span class="hljs-number">0x5C</span>,<span class="hljs-number">0x45</span>,<span class="hljs-number">0x6F</span>,<span class="hljs-number">0x62</span>,<span class="hljs-number">0x4D</span>,<span class="hljs-number">0x3F</span>]<br>flag = [<span class="hljs-number">0</span>]*<span class="hljs-number">33</span><br>flag2 = [<span class="hljs-number">0</span>]*<span class="hljs-number">33</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">33</span>):<br>    flag[i] = code[i]^ss[i]<br>    flag2[ss[i]] = flag[i]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(j)<span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> flag))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">chr</span>(j)<span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> flag2))<br></code></pre></td></tr></table></figure>

<p>输出结果如下</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211115191228010.png" alt="image-20211115191228010"></p>
<h2 id="ACTF新生赛2020-usualCrypt"><a href="#ACTF新生赛2020-usualCrypt" class="headerlink" title="[ACTF新生赛2020]usualCrypt"></a>[ACTF新生赛2020]usualCrypt</h2><p>ida反编译</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v5[<span class="hljs-number">3</span>]; <span class="hljs-comment">// [esp+8h] [ebp-74h] BYREF</span><br>  __int16 v6; <span class="hljs-comment">// [esp+14h] [ebp-68h]</span><br>  <span class="hljs-type">char</span> v7; <span class="hljs-comment">// [esp+16h] [ebp-66h]</span><br>  <span class="hljs-type">char</span> v8[<span class="hljs-number">100</span>]; <span class="hljs-comment">// [esp+18h] [ebp-64h] BYREF</span><br><br>  sub_403CF8(&amp;unk_40E140);<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, v8);<br>  v5[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;<br>  v5[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;<br>  v5[<span class="hljs-number">2</span>] = <span class="hljs-number">0</span>;<br>  v6 = <span class="hljs-number">0</span>;<br>  v7 = <span class="hljs-number">0</span>;<br>  sub_401080(v8, <span class="hljs-built_in">strlen</span>(v8), v5); <span class="hljs-comment">//base64加密</span><br>  v3 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">while</span> ( *((_BYTE *)v5 + v3) == byte_40E0E4[v3] )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( ++v3 &gt; <span class="hljs-built_in">strlen</span>((<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)v5) )<br>      <span class="hljs-keyword">goto</span> LABEL_6;<br>  &#125;<br>  sub_403CF8(aError);<br>LABEL_6:<br>  <span class="hljs-keyword">if</span> ( v3 - <span class="hljs-number">1</span> == <span class="hljs-built_in">strlen</span>(byte_40E0E4) )<br>    result = sub_403CF8(aAreYouHappyYes);<br>  <span class="hljs-keyword">else</span><br>    result = sub_403CF8(aAreYouHappyNo);<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>需要注意的是，<code>sub_401080</code>函数并非简单的base61加密，而是进行了换表</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">sub_401000</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> v1; <span class="hljs-comment">// cl</span><br><br>  <span class="hljs-keyword">for</span> ( result = <span class="hljs-number">6</span>; result &lt; <span class="hljs-number">15</span>; ++result )<br>  &#123;<br>    v1 = byte_40E0AA[result];<br>    byte_40E0AA[result] = BASE64_table_40E0A0[result];<br>    BASE64_table_40E0A0[result] = v1;<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>写出脚本换表</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c++">ABCDEFQRSTUVWXYPGHIJKLMNOZabcdefghijklmnopqrstuvwxyz0123456789+/<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iomanip&gt;</span> </span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">char</span> byte_40E0AA[<span class="hljs-number">100</span>] = <span class="hljs-string">&quot;KLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>;<br>    <span class="hljs-type">char</span> BASE64_table_40E0A0[<span class="hljs-number">100</span>] = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> result = <span class="hljs-number">6</span>; result &lt; <span class="hljs-number">15</span>; ++result)<br>    &#123;<br>        <span class="hljs-type">char</span> v1;<br>        v1 = byte_40E0AA[result];<br>        byte_40E0AA[result] = BASE64_table_40E0A0[result];<br>        BASE64_table_40E0A0[result] = v1;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>, BASE64_table_40E0A0);<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-comment">//ABCDEFQRSTUVWXYPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/</span><br></code></pre></td></tr></table></figure>

<p>上述脚本有一个问题，在源程序中，<code>byte_40E0AA</code>和<code>BASE64_table_40E0A0</code>共用一段内存，而我们写的脚本，内存是不连续的</p>
<p>也就是说，源程序的一个字符变化，另一个也立刻随之变化，而我们的脚本不会，那么脚本可以这么写</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iomanip&gt;</span> </span><br>using namespace <span class="hljs-built_in">std</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">char</span> BASE64_table_40E0A0[<span class="hljs-number">100</span>] = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> result = <span class="hljs-number">6</span>; result &lt; <span class="hljs-number">15</span>; ++result)<br>    &#123;<br>        <span class="hljs-type">char</span> v1;<br>        v1 = BASE64_table_40E0A0[result+<span class="hljs-number">10</span>];<br>        BASE64_table_40E0A0[result+<span class="hljs-number">10</span>] = BASE64_table_40E0A0[result];<br>        BASE64_table_40E0A0[result] = v1;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s&quot;</span>, BASE64_table_40E0A0);<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-comment">//ABCDEFQRSTUVWXYPGHIJKLMNOZabcdefghijklmnopqrstuvwxyz0123456789+/</span><br></code></pre></td></tr></table></figure>

<p>这样实现的效果就和源代码一样，因为内存是同一块内存，写python来base解密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> string<br><br>str1 = <span class="hljs-string">&quot;zMXHz3TIgnxLxJhFAdtZn2fFk3lYCrtPC2l9&quot;</span><br>str2 = str1.swapcase()<br>string1 = <span class="hljs-string">&quot;ABCDEFQRSTUVWXYPGHIJKLMNOZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span><br>string2 = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span><br><br><span class="hljs-built_in">print</span> (base64.b64decode(str2.translate(<span class="hljs-built_in">str</span>.maketrans(string1,string2))))<br><span class="hljs-comment">#flag&#123;bAse64_h2s_a_Surprise&#125;</span><br></code></pre></td></tr></table></figure>

<h2 id="Youngter-drive"><a href="#Youngter-drive" class="headerlink" title="Youngter-drive"></a>Youngter-drive</h2><p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20220112184531638.png" alt="image-20220112184531638"></p>
<p>upx壳，使用官方upx脱壳</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main_0</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  HANDLE v4; <span class="hljs-comment">// [esp+D0h] [ebp-14h]</span><br>  HANDLE hObject; <span class="hljs-comment">// [esp+DCh] [ebp-8h]</span><br><br>  ((<span class="hljs-type">void</span> (*)(<span class="hljs-type">void</span>))sub_4110FF)();<br>  ::hObject = CreateMutexW(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>  j_strcpy(Destination, &amp;Source);<br>  hObject = CreateThread(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, StartAddress, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>  v4 = CreateThread(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, sub_41119F, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>  CloseHandle(hObject);<br>  CloseHandle(v4);<br>  <span class="hljs-keyword">while</span> ( dword_418008 != <span class="hljs-number">-1</span> )<br>    ;<br>  sub_411190();<br>  CloseHandle(::hObject);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">sub_411BD0</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-built_in">printf</span>(<br>    <span class="hljs-string">&quot;1111111111111111111111111111111111111111111111111111111111111111111111111111111\n&quot;</span><br>    <span class="hljs-string">&quot;*******************************************************************************\n&quot;</span><br>    <span class="hljs-string">&quot;**************             ****************************************************\n&quot;</span><br>    <span class="hljs-string">&quot;**************   ********   *********************                 *************\n&quot;</span><br>    <span class="hljs-string">&quot;**************   *********  *********************   ***************************\n&quot;</span><br>    <span class="hljs-string">&quot;**************   *********  *********************   ***************************\n&quot;</span><br>    <span class="hljs-string">&quot;**************   *********  *********************   ***************************\n&quot;</span><br>    <span class="hljs-string">&quot;**************   *******   **********************   ***************************\n&quot;</span><br>    <span class="hljs-string">&quot;**************   ****   *************************   ***************************\n&quot;</span><br>    <span class="hljs-string">&quot;**************   *    ***************************                **************\n&quot;</span><br>    <span class="hljs-string">&quot;**************   ***    *************************   ***************************\n&quot;</span><br>    <span class="hljs-string">&quot;**************   ******   ***********************   ***************************\n&quot;</span><br>    <span class="hljs-string">&quot;**************   ********   *********************   ***************************\n&quot;</span><br>    <span class="hljs-string">&quot;**************   **********   *******************   ***************************\n&quot;</span><br>    <span class="hljs-string">&quot;**************   ***********    *****************                 *************\n&quot;</span><br>    <span class="hljs-string">&quot;*******************************************************************************\n&quot;</span><br>    <span class="hljs-string">&quot;1111111111111111111111111111111111111111111111111111111111111111111111111111111\n&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;input flag:\n&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%36s&quot;</span>, Source);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>可以知道source是我们的输入</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> __stdcall <span class="hljs-title function_">StartAddress_0</span><span class="hljs-params">(<span class="hljs-type">int</span> a1)</span><br>&#123;<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    WaitForSingleObject(hObject, <span class="hljs-number">0xFFFFFFFF</span>);<br>    <span class="hljs-keyword">if</span> ( dword_418008 &gt; <span class="hljs-number">-1</span> )<br>    &#123;<br>      sub_41112C((<span class="hljs-type">int</span>)Source, dword_418008);<br>      --dword_418008; <span class="hljs-comment">//29</span><br>      Sleep(<span class="hljs-number">0x64</span>u);<br>    &#125;<br>    ReleaseMutex(hObject);<br>  &#125;<br>&#125;<br><span class="hljs-type">char</span> *__cdecl <span class="hljs-title function_">sub_411940</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> a2)</span><br>&#123;  <span class="hljs-comment">//这里的a1是我们输入字符串的地址</span><br>  <span class="hljs-type">char</span> *result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> v3; <span class="hljs-comment">// [esp+D3h] [ebp-5h]</span><br><br>  v3 = *(_BYTE *)(a2 + a1);<br>  <span class="hljs-keyword">if</span> ( (v3 &lt; <span class="hljs-number">97</span> || v3 &gt; <span class="hljs-number">122</span>) &amp;&amp; (v3 &lt; <span class="hljs-number">65</span> || v3 &gt; <span class="hljs-number">90</span>) )<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">if</span> ( v3 &lt; <span class="hljs-number">97</span> || v3 &gt; <span class="hljs-number">122</span> )<br>  &#123;<br>    result = off_418000[<span class="hljs-number">0</span>]; <span class="hljs-comment">//QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm</span><br>    *(_BYTE *)(a2 + a1) = off_418000[<span class="hljs-number">0</span>][*(<span class="hljs-type">char</span> *)(a2 + a1) - <span class="hljs-number">38</span>];<br>      <span class="hljs-comment">//a1[i] = off_418000[a1[i]-38] </span><br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    result = off_418000[<span class="hljs-number">0</span>];<br>    *(_BYTE *)(a2 + a1) = off_418000[<span class="hljs-number">0</span>][*(<span class="hljs-type">char</span> *)(a2 + a1) - <span class="hljs-number">96</span>];<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">void __stdcall sub_411B10(int a1)<br>&#123;<br>  while ( 1 )<br>  &#123;<br>    WaitForSingleObject(hObject, 0xFFFFFFFF);<br>    if ( dword_418008 &gt; -1 )<br>    &#123;<br>      Sleep(0x64u);<br>      --dword_418008;<br>    &#125;<br>    ReleaseMutex(hObject);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>两个进程交替运行，当计数为奇数时，对数据进行变换，计数为偶数时，数据不变</p>
<p>写出脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">s = <span class="hljs-string">&#x27;QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm&#x27;</span> <span class="hljs-comment">#off_418000</span><br>d = <span class="hljs-string">&#x27;TOiZiZtOrYaToUwPnToBsOaOapsyS&#x27;</span> <span class="hljs-comment">#off_418004</span><br>f = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(d)):<br>    <span class="hljs-keyword">if</span> i%<span class="hljs-number">2</span> == <span class="hljs-number">0</span>:<br>        f = f + d[i]<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">if</span>(d[i].isupper()):<br>            f = f + <span class="hljs-built_in">chr</span>(s.find(d[i])+<span class="hljs-number">96</span>)<br>        <span class="hljs-keyword">else</span>:<br>            f = f + <span class="hljs-built_in">chr</span>(s.find(d[i])+<span class="hljs-number">38</span>)<br><span class="hljs-built_in">print</span>(f)<br><span class="hljs-comment">#ThisisthreadofwindowshahaIsE</span><br></code></pre></td></tr></table></figure>

<h2 id="WUSTCTF2020-level2"><a href="#WUSTCTF2020-level2" class="headerlink" title="[WUSTCTF2020]level2"></a>[WUSTCTF2020]level2</h2><p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20220113105534066.png" alt="image-20220113105534066"></p>
<p>upx壳，upx-d脱壳</p>
<p>（我愿称之为shi题）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs asm">public main<br>main proc near<br><br>var_C= dword ptr -0Ch<br>var_4= dword ptr -4<br>argc= dword ptr  8<br>argv= dword ptr  0Ch<br>envp= dword ptr  10h<br><br>; __unwind &#123;<br>lea     ecx, [esp+4]<br>and     esp, 0FFFFFFF0h<br>push    dword ptr [ecx-4]<br>push    ebp<br>mov     ebp, esp<br>push    ecx<br>sub     esp, 14h<br>mov     [ebp+var_C], offset flag ; &quot;wctf2020&#123;Just_upx_-d&#125;&quot;<br>sub     esp, 0Ch<br>push    offset aWhereIsIt ; &quot;where is it?&quot;<br>call    puts<br>add     esp, 10h<br>mov     eax, 0<br>mov     ecx, [ebp+var_4]<br>leave<br>lea     esp, [ecx-4]<br>retn<br>; &#125; // starts at 804887C<br>main endp<br></code></pre></td></tr></table></figure>

<p>不解释，<code>wctf2020&#123;Just_upx_-d&#125;</code></p>
<h2 id="相册"><a href="#相册" class="headerlink" title="相册"></a>相册</h2><p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211117120424226.png" alt="image-20211117120424226"></p>
<p>这是一道安卓病毒题，使用jadx进行逆向分析，找出完整邮箱即为flag</p>
<p>使用jadx搜索mail</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211117120757759.png" alt="image-20211117120757759"></p>
<p>看见了java里实现的 sendmail ，跟进，分析一下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">sendMailByJavaMail</span><span class="hljs-params">(String mailto, String title, String mailmsg)</span> &#123;<br>        <span class="hljs-keyword">if</span> (!debug) &#123;<br>            <span class="hljs-type">Mail</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mail</span>(C2.MAILUSER, C2.MAILPASS);<br>            m.set_host(C2.MAILHOST);<br>            m.set_port(C2.PORT);<br>            m.set_debuggable(<span class="hljs-literal">true</span>);<br>            m.set_to(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]&#123;mailto&#125;);<br>            m.set_from(C2.MAILFROME);<br>            m.set_subject(title);<br>            m.setBody(mailmsg);<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">if</span> (m.send()) &#123;<br>                    Log.i(<span class="hljs-string">&quot;IcetestActivity&quot;</span>, <span class="hljs-string">&quot;Email was sent successfully.&quot;</span>);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    Log.i(<span class="hljs-string">&quot;IcetestActivity&quot;</span>, <span class="hljs-string">&quot;Email was sent failed.&quot;</span>);<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                Log.e(<span class="hljs-string">&quot;MailApp&quot;</span>, <span class="hljs-string">&quot;Could not send email&quot;</span>, e);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br><br></code></pre></td></tr></table></figure>

<p>可以看到，该函数意图将 mailto 作为邮件接收者，那我们可以看看谁调用了它</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211117121059468.png" alt="image-20211117121059468"></p>
<p>第二个跳转过去，查看代码，可以看到这样一条语句</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (!A2.isEmpty(notebooks)) &#123;<br>            A2.sendMailByJavaMail(C2.MAILSERVER, <span class="hljs-string">&quot;通讯录(&quot;</span> + tel + <span class="hljs-string">&quot;IMEI&quot;</span> + ((TelephonyManager) <span class="hljs-built_in">this</span>.context.getSystemService(<span class="hljs-string">&quot;phone&quot;</span>)).getDeviceId() + <span class="hljs-string">&quot;)&quot;</span>, notebooks);<br>        &#125;<br></code></pre></td></tr></table></figure>

<p>我们看看是谁引用了 MAILSERVER </p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211117124944156.png" alt="image-20211117124944156"></p>
<p>看到是base64加密，那么我们把.so文件扔到ida里查字符串</p>
<p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20211117141009152.png" alt="image-20211117141009152"></p>
<p>全部进行base64解密，有一个就是flag</p>
<p>flag：flag{<a href="mailto:&#x31;&#56;&#50;&#49;&#56;&#x34;&#x36;&#53;&#x31;&#x32;&#x35;&#64;&#x31;&#x36;&#51;&#46;&#99;&#111;&#109;">&#x31;&#56;&#50;&#49;&#56;&#x34;&#x36;&#53;&#x31;&#x32;&#x35;&#64;&#x31;&#x36;&#51;&#46;&#99;&#111;&#109;</a>}</p>
<h2 id="HDCTF2019-Maze"><a href="#HDCTF2019-Maze" class="headerlink" title="[HDCTF2019]Maze"></a>[HDCTF2019]Maze</h2><p><img src="../images/loading.png" data-original="/2021/11/01/Buuctf_Re/image-20220113111051582.png" alt="image-20220113111051582"></p>
<p>upx壳，upx-d脱壳</p>
<p>有花指令，把call nop掉就可以正常反编译</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+10h] [ebp-14h]</span><br>  <span class="hljs-type">char</span> v5[<span class="hljs-number">16</span>]; <span class="hljs-comment">// [esp+14h] [ebp-10h] BYREF</span><br><br>  sub_401140(aGoThroughTheMa);<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%14s&quot;</span>, v5);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">13</span>; ++i )<br>  &#123;<br>    <span class="hljs-keyword">switch</span> ( v5[i] )<br>    &#123;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;a&#x27;</span>:<br>        --*(_DWORD *)asc_408078;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;d&#x27;</span>:<br>        ++*(_DWORD *)asc_408078;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;s&#x27;</span>:<br>        --dword_40807C;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;w&#x27;</span>:<br>        ++dword_40807C;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">default</span>:<br>        <span class="hljs-keyword">continue</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( *(_DWORD *)asc_408078 == <span class="hljs-number">5</span> &amp;&amp; dword_40807C == <span class="hljs-number">-4</span> )<br>  &#123;<br>    sub_401140(aCongratulation);<br>    sub_401140(aHereIsTheFlagF);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    sub_401140(aTryAgain);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">*******+********* ******    ****   ******* **F******    **************\x00<br><br>*******+**<br>******* **<br>****    **<br>**   *****<br>** **F****<br>**    ****<br>**********<br>flag&#123;ssaaasaassdddw&#125;<br></code></pre></td></tr></table></figure>

<p>+号是起点，F是终点，按7行一列排一下，就是迷宫</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Dangofil</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2021/11/01/Buuctf_Re/">http://example.com/2021/11/01/Buuctf_Re/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Dangofilの博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Buuctf/">Buuctf</a></div><div class="post_share"><div class="social-share" data-image="/img/favicon.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/11/03/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB%E2%80%94%E2%80%94%E9%93%BE%E6%8E%A5%E3%80%81%E8%A3%85%E8%BD%BD%E4%B8%8E%E5%BA%93/" title="程序员的自我修养——链接、装载与库"><div class="cover" style="background: https://eternitywith.gitee.io/image/16.jpg"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">程序员的自我修养——链接、装载与库</div></div></a></div><div class="next-post pull-right"><a href="/2021/11/01/to-do-list/" title="to do list"><div class="cover" style="background: https://eternitywith.gitee.io/image/42.jpg"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">to do list</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/01/13/page2/" title="Buuctf_Re page2"><div class="cover" style="background: https://eternitywith.gitee.io/image/33.jpg"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-13</div><div class="title">Buuctf_Re page2</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="../images/loading.png" data-original="/img/favicon.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Dangofil</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">61</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Dangofil" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/2209858323@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Re"><span class="toc-number">1.</span> <span class="toc-text">Re</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#easyre"><span class="toc-number">1.1.</span> <span class="toc-text">easyre</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#reverse1"><span class="toc-number">1.2.</span> <span class="toc-text">reverse1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#reverse2"><span class="toc-number">1.3.</span> <span class="toc-text">reverse2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E6%B6%B5%E7%9A%84%E8%BD%AF%E4%BB%B6"><span class="toc-number">1.4.</span> <span class="toc-text">内涵的软件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%B9%B4%E5%BF%AB%E4%B9%90"><span class="toc-number">1.5.</span> <span class="toc-text">新年快乐</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#xor"><span class="toc-number">1.6.</span> <span class="toc-text">xor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#helloworld"><span class="toc-number">1.7.</span> <span class="toc-text">helloworld</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#reverse3"><span class="toc-number">1.8.</span> <span class="toc-text">reverse3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E4%B8%80%E6%A0%B7%E7%9A%84flag"><span class="toc-number">1.9.</span> <span class="toc-text">不一样的flag</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SimpleRev"><span class="toc-number">1.10.</span> <span class="toc-text">SimpleRev</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java%E9%80%86%E5%90%91%E8%A7%A3%E5%AF%86"><span class="toc-number">1.11.</span> <span class="toc-text">Java逆向解密</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GXYCTF2019-luck-guy"><span class="toc-number">1.12.</span> <span class="toc-text">[GXYCTF2019]luck_guy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%AE%E5%BC%80%E6%9C%89%E5%A5%96"><span class="toc-number">1.13.</span> <span class="toc-text">刮开有奖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#findit"><span class="toc-number">1.14.</span> <span class="toc-text">findit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BJDCTF2020-JustRE"><span class="toc-number">1.15.</span> <span class="toc-text">[BJDCTF2020]JustRE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%B3%A8%E5%86%8C%E5%99%A8"><span class="toc-number">1.16.</span> <span class="toc-text">简单注册器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GWCTF-2019-pyre"><span class="toc-number">1.17.</span> <span class="toc-text">[GWCTF 2019]pyre</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020-easyre"><span class="toc-number">1.18.</span> <span class="toc-text">[ACTF新生赛2020]easyre</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rsa"><span class="toc-number">1.19.</span> <span class="toc-text">rsa</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020-rome"><span class="toc-number">1.20.</span> <span class="toc-text">[ACTF新生赛2020]rome</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CrackRTF"><span class="toc-number">1.21.</span> <span class="toc-text">CrackRTF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2019%E7%BA%A2%E5%B8%BD%E6%9D%AF-easyRE"><span class="toc-number">1.22.</span> <span class="toc-text">[2019红帽杯]easyRE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FlareOn4-login"><span class="toc-number">1.23.</span> <span class="toc-text">[FlareOn4]login</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GUET-CTF2019-re"><span class="toc-number">1.24.</span> <span class="toc-text">[GUET-CTF2019]re</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SUCTF2019-SignIn"><span class="toc-number">1.25.</span> <span class="toc-text">[SUCTF2019]SignIn</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WUSTCTF2020-level1"><span class="toc-number">1.26.</span> <span class="toc-text">[WUSTCTF2020]level1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Transform"><span class="toc-number">1.27.</span> <span class="toc-text">Transform</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020-usualCrypt"><span class="toc-number">1.28.</span> <span class="toc-text">[ACTF新生赛2020]usualCrypt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Youngter-drive"><span class="toc-number">1.29.</span> <span class="toc-text">Youngter-drive</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WUSTCTF2020-level2"><span class="toc-number">1.30.</span> <span class="toc-text">[WUSTCTF2020]level2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%86%8C"><span class="toc-number">1.31.</span> <span class="toc-text">相册</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HDCTF2019-Maze"><span class="toc-number">1.32.</span> <span class="toc-text">[HDCTF2019]Maze</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/05/25/cpp-reserve/" title="cpp_reserve"><div style="background: https://eternitywith.gitee.io/image/40.jpg"></div></a><div class="content"><a class="title" href="/2023/05/25/cpp-reserve/" title="cpp_reserve">cpp_reserve</a><time datetime="2023-05-25T15:48:32.000Z" title="发表于 2023-05-25 23:48:32">2023-05-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/13/litctf/" title="litctf"><div style="background: https://eternitywith.gitee.io/image/13.jpg"></div></a><div class="content"><a class="title" href="/2023/05/13/litctf/" title="litctf">litctf</a><time datetime="2023-05-13T07:51:11.000Z" title="发表于 2023-05-13 15:51:11">2023-05-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/10/5-11%E5%87%BA%E9%A2%98/" title="5-11出题"><div style="background: https://eternitywith.gitee.io/image/42.jpg"></div></a><div class="content"><a class="title" href="/2023/05/10/5-11%E5%87%BA%E9%A2%98/" title="5-11出题">5-11出题</a><time datetime="2023-05-10T00:40:02.000Z" title="发表于 2023-05-10 08:40:02">2023-05-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/04/26/aliyunCTF/" title="aliyunCTF"><div style="background: https://eternitywith.gitee.io/image/33.jpg"></div></a><div class="content"><a class="title" href="/2023/04/26/aliyunCTF/" title="aliyunCTF">aliyunCTF</a><time datetime="2023-04-26T00:52:16.000Z" title="发表于 2023-04-26 08:52:16">2023-04-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/04/19/CyberHavocCTF-wp/" title="CyberHavocCTF_wp"><div style="background: https://eternitywith.gitee.io/image/19.jpg"></div></a><div class="content"><a class="title" href="/2023/04/19/CyberHavocCTF-wp/" title="CyberHavocCTF_wp">CyberHavocCTF_wp</a><time datetime="2023-04-19T04:09:39.000Z" title="发表于 2023-04-19 12:09:39">2023-04-19</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Dangofil</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e&&e()},t.src!==a&&(n.src=a))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this);</script></body></html>